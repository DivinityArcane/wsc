var wsc={};wsc.VERSION="1.0.4";wsc.STATE="release candidate";wsc.REVISION="0.14.89";wsc.defaults={};wsc.defaults.theme="wsct_default";wsc.defaults.themes=["wsct_default","wsct_dAmn"];function EventEmitter(){var k={},a=this;function j(p,q){var m=k[p]||false;if(m===false){k[p]=[q];return a}k[p].unshift(q);return a}function g(m){k[m]=[];return a}function b(){var m=Array.prototype.slice.call(arguments);var r=m.shift();var q=k[r]||false;if(q===false){return a}for(var p in q){if(q.hasOwnProperty(p)){bubble=q[p].apply({},m);if(bubble===false){break}}}return a}function l(m){return k[m]||[]}this.addListener=j;this.removeListeners=g;this.emit=b;this.listeners=l}wsc.Transport=function(j,b,g,a){this.sock=null;this.conn=null;this.server=j;this.open(b);this.message(g);this.disconnect(a)};wsc.Transport.Create=function(j,b,g,a){if(typeof io!=="undefined"){return new wsc.SocketIO(j,b,g,a)}if(!window.WebSocket){throw"This browser does not support websockets."}return new wsc.WebSocket(j,b,g,a)};wsc.Transport.prototype.open=function(a){this._open=a||this.sopen
};wsc.Transport.prototype.message=function(a){this._message=a||this.smessage};wsc.Transport.prototype.disconnect=function(a){this._disconnect=a||this.sdisconnect};wsc.Transport.prototype.sopen=function(){};wsc.Transport.prototype.smessage=function(){};wsc.Transport.prototype.sdisconnect=function(){};wsc.Transport.prototype._open=function(b,a){};wsc.Transport.prototype._message=function(a){};wsc.Transport.prototype._disconnect=function(a){};wsc.Transport.prototype.connect=function(){};wsc.Transport.prototype.send=function(a){};wsc.Transport.prototype.close=function(){};wsc.WebSocket=function(j,b,g,a){this.sock=null;this.conn=null;this.server=j;this.open(b);this.message(g);this.disconnect(a)};wsc.WebSocket.prototype=new wsc.Transport;wsc.WebSocket.prototype.constructor=wsc.WebSocket;wsc.WebSocket.prototype.onopen=function(b,a){this.sock=a||this.conn;this._open(b,this)};wsc.WebSocket.prototype.ondisconnect=function(a){this.sock=null;this.conn=null;this._disconnect(a)};wsc.WebSocket.prototype.connect=function(){var a=this;
this.conn=new WebSocket(this.server);this.conn.onopen=function(g,b){a.onopen(g,b)};this.conn.onmessage=this._message;this.conn.onclose=function(b){a.ondisconnect(b)}};wsc.WebSocket.prototype.send=function(a){if(this.sock==null){return -1}return this.sock.send(replaceAll(escape(a),"+","%2B"))};wsc.WebSocket.prototype.close=function(){if(this.sock==null){return}this.sock.close()};wsc.SocketIO=function(j,b,g,a){this.sock=null;this.conn=null;this.server=j;this.open(b);this.message(g);this.disconnect(a)};wsc.SocketIO.prototype=new wsc.Transport("");wsc.SocketIO.prototype.constructor=wsc.SocketIO;wsc.SocketIO.prototype.connect=function(){var a=this;this.conn=io.connect(this.server);this.conn.on("connect",function(g,b){a.onopen(g,b)});this.conn.on("message",function(b){a._message({data:b})});this.conn.on("close",function(b){a.ondisconnect(b)})};wsc.SocketIO.prototype.onopen=function(b,a){this.sock=a||this.conn;this._open(b,this)};wsc.SocketIO.prototype.ondisconnect=function(a){this.sock=null;this.conn=null;
this._disconnect(a)};wsc.SocketIO.prototype.send=function(a){if(this.sock==null){return -1}return this.sock.send(replaceAll(encodeURIComponent(a)," ","+"))};wsc.SocketIO.prototype.close=function(){if(this.sock==null){return}this.sock.close()};function $_GET(g,b){b=b||window.location.search;var a=new RegExp("&"+g+"(?:=([^&]*))?(?=&|$)","i");b=b.replace(/^\?/,"&").match(a);if(b){return typeof b[1]!="undefined"?decodeURIComponent(b[1].replace(/\+/g,"%20")):""}}function UnixTimestamp(a){ret=new Date(a*1000);return ret}var Months=["January","February","March","April","May","June","July","August","September","October","November","December"];function PosEnd(a){return a=="1"?"st":(a=="2"?"nd":(a=="3"?"rd":"th"))}function DateStamp(a){a=UnixTimestamp(a);date=String(a.getDate());month=a.getMonth();df=date[date.length-1];return date+PosEnd(df)+" of "+Months[month]+", "+a.getFullYear()}function caseInsensitiveSort(j,g){j=j.toLowerCase();g=g.toLowerCase();return((j>g)?1:(j<g?-1:0))}function EscapeRegExp(a){return a.replace((new RegExp("(\\"+["/",".","*","+","?","|","(",")","[","]","{","}","\\"].join("|\\")+")","g")),"\\$1")
}String.format=function(){var a=Array.prototype.slice.call(arguments);var g=a.shift();a=a.shift();if(a.length==0){return g}var b=a.length;return g.replace(/{(\d+)}/g,function(j,k){if(b<=parseInt(k)){return j}return typeof a[k]!="undefined"?a[k]:j})};replaceAllRaw=function(g,b,a){while(g.indexOf(b)>-1){g=g.replace(b,a)}return g};replaceAll=function(g,b,a){return g.split(b).join(a)};Object.size=function(g){var b=0,a;for(a in g){if(g.hasOwnProperty(a)){b++}}return b};Object.steal=function(j,g){for(var k in g){if(!j.hasOwnProperty(k)&&!g.hasOwnProperty(k)){continue}if(typeof j[k]=="object"){j[k]=Object.extend(j[k],g[k])}else{j[k]=g[k]}}};Object.extend=function(j,g){var k={};Object.steal(k,j);Object.steal(k,g);return k};function zeroPad(b,a){a=a||2;a-=b.toString().length;if(a>0){return new Array(a+(/\./.test(b)?2:1)).join("0")+b}return b+""}function formatTime(b,a){a=a||new Date();HH=a.getHours();hh=HH;b=replaceAll(b,"{mm}",zeroPad(a.getMinutes(),2));b=replaceAll(b,"{ss}",zeroPad(a.getSeconds(),2));
mr="am";if(hh>11){mr="pm";if(hh>12){hh=hh-12}}else{if(hh==0){hh="12"}}b=replaceAll(b,"{hh}",zeroPad(hh,2));b=replaceAll(b,"{HH}",zeroPad(HH,2));b=replaceAll(b,"{mr}",mr);return b}function oxlist(a){last=a.pop();ret=a.join(", ");return ret+(ret.length>0?", and ":"")+last}function pluralise(b,a){return b+(a==1?"":"s")}function timeLengthString(g){var a=g;var j=[];j.unshift(["second",Math.round(a%60)]);a/=Math.round(60);j.unshift(["minute",Math.round(a%60)]);a/=Math.round(60);j.unshift(["hour",Math.round(a%24)]);a/=Math.round(24);j.unshift(["day",a]);var b=[];for(i in j){lapse=j[i];if(lapse[1]<1){continue}b.push(lapse[1].toString()+" "+pluralise(lapse[0],lapse[1]))}return oxlist(b)}wsc.Storage=function(b,a){this.ns=b||null;this.parent=a||null};wsc.Storage.prototype.folder=function(a){if(this.ns!=null){a=this.ns+"."+a}return new wsc.Storage(a,this)};wsc.Storage.prototype.get=function(a,g){if(this.ns!=null){a=this.ns+"."+a}try{if(!localStorage.hasOwnProperty(a)){return g}return localStorage[a]
}catch(b){return g}};wsc.Storage.prototype.set=function(a,g){if(this.ns!=null){a=this.ns+"."+a}try{localStorage[a]=g}catch(b){}};wsc.Storage.prototype.remove=function(a){if(this.ns!=null){a=this.ns+"."+a}try{if(!localStorage.hasOwnProperty(a)){return false}return delete localStorage[a]}catch(b){}return false};var chains=[["recv","admin"]];wsc.Packet=function(b,j){if(!(b)){return null}var a={cmd:null,param:null,arg:{},body:null,sub:[],raw:b};j=j||"=";try{idx=b.indexOf("\n\n");if(idx>-1){a.body=b.substr(idx+2);b=b.substr(0,idx)}args=b.split("\n");if(args[0].indexOf(j)==-1){cline=args.shift().split(" ");a.cmd=cline.shift()||null;if(cline.length>0){a.param=cline.join(" ")}}for(n in args){arg=args[n];si=arg.search(j);if(si==-1){continue}a.arg[arg.substr(0,si)]=arg.substr(si+j.length)||""}if(a.body!=null){subs=a.body.split("\n\n");for(i in subs){sub=wsc.Packet(subs[i],j);if(sub==null){break}sub.body=subs.slice(i+1).join("\n\n");a.sub.push(sub)}}}catch(g){return null}a.toString=function(){return packetToString(a)
};a.name=packetEvtName(a);return a};function wsc_packetstr(k,l,g,a){var b="";if(k){b=k;if(l){b=b+" "+l}}if(g){for(var j in g){b=b+"\n"+j+"="+g[j]}}b=b+"\n";if(a){b=b+"\n"+a}return b}function packetToString(a){return wsc_packetstr(a.cmd,a.param,a.arg,a.body)}function packetEvtName(b){var j=b.cmd;var a=null;for(var g in chains){a=chains[g];if(a[0]!=j){continue}var k=b.sub[0];j=j+"_"+k.cmd;if(a.length>1&&k.param!=undefined){if(a[1]==k.cmd){return j+"_"+k.param}}}return j}wsc.Channel=function(a,b,g){this.info={members:{},pc:{},pc_order:[],title:{content:"",by:"",ts:""},topic:{content:"",by:"",ts:""},};this.client=a;this.hidden=g;this.ui=null;this.raw=a.format_ns(b);this.selector=a.deform_ns(b).slice(1).toLowerCase();this.namespace=a.deform_ns(b);this.monitor=Object.size(this.client.channelo)==0};wsc.Channel.prototype.build=function(){this.info.members={};this.client.ui.create_channel(this.namespace,this.hidden);this.ui=this.client.ui.channel(ns)};wsc.Channel.prototype.remove=function(){if(this.ui==null){return
}this.ui.manager.remove_channel(this.namespace)};wsc.Channel.prototype.hide=function(){if(this.ui==null){return}this.ui.hide()};wsc.Channel.prototype.show=function(){if(this.ui==null){return}this.ui.show()};wsc.Channel.prototype.log=function(a){if(this.ui==null){return}this.ui.log(a)};wsc.Channel.prototype.logItem=function(a){if(this.ui==null){return}this.ui.log_item(a)};wsc.Channel.prototype.server_message=function(b,a){if(this.ui==null){return}this.ui.server_message(b,a)};wsc.Channel.prototype.clear=function(a){if(this.ui==null){return}if(!a){this.ui.clear()}else{this.ui.clear_user(a)}};wsc.Channel.prototype.log_whois=function(a){if(this.ui==null){return}this.ui.log_whois(a)};wsc.Channel.prototype.log_pc=function(a,b){if(this.ui==null){return}this.ui.log_pc(a,b)};wsc.Channel.prototype.property=function(a){var b=a.pkt.arg["p"];switch(b){case"title":case"topic":this.set_header(b,a);break;case"privclasses":this.set_privclasses(a);break;case"members":this.set_members(a);break;default:this.server_message("Received unknown property "+b+" received in "+this.info.namespace+".");
break}};wsc.Channel.prototype.set_header=function(a,b){this.info[a]["content"]=b.value.text()||"";this.info[a]["by"]=b.by;this.info[a]["ts"]=b.ts;if(this.ui==null){return}this.ui.set_header(a,b.value.html()||"")};wsc.Channel.prototype.set_privclasses=function(j){this.info.pc={};this.info.pc_order=[];var a=j.pkt.body.split("\n");var g=[];for(var b in a){if(!a.hasOwnProperty(b)){continue}g=a[b].split(":");if(g.length==1){continue}this.info.pc_order.push(parseInt(g[0]));this.info.pc[parseInt(g[0])]=g[1]}this.info.pc_order.sort(function(l,k){return k-l})};wsc.Channel.prototype.get_privclass_order=function(a){a=a.toLowerCase();for(var b in this.info.pc){if(!this.info.pc.hasOwnProperty(b)){continue}if(this.info.pc[b].toLowerCase()==a){return b}}};wsc.Channel.prototype.set_members=function(b){this.info.members={};for(var a in b.pkt.sub){if(!b.pkt.sub.hasOwnProperty(a)){continue}this.register_user(b.pkt.sub[a])}this.set_user_list()};wsc.Channel.prototype.set_user_list=function(){if(Object.size(this.info.members)==0){return
}var m=this.get_usernames();var q={};for(var j in m){if(!m.hasOwnProperty(j)){continue}var k=m[j];var b=this.info.members[k];if(!(b.pc in q)){q[b.pc]={name:b.pc,users:[]}}var a=b.conn==1?"":"["+b.conn+"]";var r=b.symbol;uinfo={name:k,symbol:r,conn:b.conn,hover:{member:b,name:k,avatar:'<img class="avatar" src="" height="50" width="50" />',link:r+'<a target="_blank" href="http://'+k+"."+this.client.settings.domain+'/">'+k+"</a>",info:[]}};q[b.pc].users.push(uinfo)}var g=[];for(var l in this.info.pc_order){var p=this.info.pc[this.info.pc_order[l]];if(!(p in q)){continue}g.push(q[p])}if(this.ui!=null){this.ui.set_user_list(g)}this.client.trigger("set.userlist",{name:"set.userlist",ns:this.info.namespace})};wsc.Channel.prototype.register_user=function(a){var b=a.param;if(this.info.members[b]==undefined){this.info.members[b]=a.arg;this.info.members[b]["username"]=b;this.info.members[b]["conn"]=1}else{for(i in a.arg){this.info.members[b][i]=a.arg[i]}this.info.members[b]["conn"]++}};wsc.Channel.prototype.get_usernames=function(){var b=[];
for(var a in this.info.members){b.push(a)}b.sort(caseInsensitiveSort);return b};wsc.Channel.prototype.remove_user=function(a,b){b=b||false;var g=this.info.members[a];if(g==undefined){return}g.conn--;if(g.conn>0&&!b){return}delete this.info.members[a]};wsc.Channel.prototype.recv_join=function(b){var a=new wsc.Packet("user "+b.user+"\n"+b.info);this.register_user(a);this.set_user_list()};wsc.Channel.prototype.recv_part=function(a){this.remove_user(a.user);this.set_user_list()};wsc.Channel.prototype.recv_msg=function(b){var a=this.client.settings.username.toLowerCase();if(a==b.user.toLowerCase()){return}var g=b.message.toLowerCase();if(g.indexOf(a)<0){return}if(this.ui!=null){this.ui.highlight()}this.client.trigger("pkt.recv_msg.highlighted",b)};wsc.Channel.prototype.recv_privchg=function(a){var b=this.info.members[a.user];if(!b){return}b.pc=a.pc;this.set_user_list()};wsc.Channel.prototype.recv_kicked=function(a){this.remove_user(a.user,true);this.set_user_list()};wsc.MessageString=function(a,b){this._parser=b||new wsc.MessageParser();
this.raw=a};with(wsc.MessageString.prototype=new String){constructor=wsc.MessageParser;toString=valueOf=function(){return this.raw}}wsc.MessageString.prototype.html=function(){return this.raw};wsc.MessageString.prototype.text=function(){return this.raw};wsc.MessageString.prototype.ansi=function(){return this.raw};wsc.MessageParser=function(){};wsc.MessageParser.prototype.parse=function(a){return new wsc.MessageString(a,this)};wsc.MessageParser.prototype.render=function(b,a){return a.raw};wsc.Protocol=function(b){this.mparser=b||new wsc.MessageParser;this.chains=[["recv","admin"]];this.maps={chatserver:["version"],login:["username",["e"],"data"],join:["ns",["e"]],part:["ns",["e","*r"]],property:["ns",["p","by","ts"],"*value"],recv_msg:[null,[["from","user"]],"*message"],recv_npmsg:[null,[["from","user"]],"message"],recv_action:[null,["s",["from","user"]],"*message"],recv_join:["user",["s"],"*info"],recv_part:["user",["s","r"]],recv_privchg:["user",["s","by","pc"]],recv_kicked:["user",[["i","s"],"by"],"*r"],recv_admin_create:[null,["p",["by","user"],["name","pc"],"privs"]],recv_admin_update:[null,["p",["by","user"],["name","pc"],"privs"]],recv_admin_rename:[null,["p",["by","user"],"prev",["name","pc"]]],recv_admin_move:[null,["p",["by","user"],"prev",["name","pc"],["n","affected"]]],recv_admin_remove:[null,["p",["by","user"],["name","pc"],["n","affected"]]],recv_admin_show:[null,["p"],"info"],recv_admin_showverbose:[null,["p"],"info"],recv_admin_privclass:[null,["p","e"],"command"],kicked:["ns",[["by","user"]],"*r"],ping:[],disconnect:[null,["e"]],send:["ns",["e"]],kick:["ns",[["u","user"],"e"]],get:["ns",["p","e"]],set:["ns",["p","e"]],kill:["ns",["e"]],unknown:[null,null,null,"packet"],};
var a=this;this.mapper={recv:function(k,j,g){j.ns=k.param;return a.map(k.sub[0],j,g)}};this.messages={chatserver:['<span class="servermsg">** Connected to llama {version} *</span>',false,true],login:['<span class="servermsg">** Login as {username}: "{e}" *</span>',false,true],join:['<span class="servermsg">** Join {ns}: "{e}" *</span>',true],part:['<span class="servermsg">** Part {ns}: "{e}" * <em>{r}</em></span>',true],property:['<span class="servermsg">** Got {p} for {ns} *</span>',true],recv_msg:['<span class="cmsg user u-{user}"><strong>&lt;{user}&gt;</strong></span><span class="cmsg u-{user}">{message}</span>'],recv_npmsg:['<span class="cmsg user u-{user}"><strong>&lt;{user}&gt;</strong></span><span class="cmsg u-{user}">{message}</span>'],recv_action:['<span class="caction user u-{user}"><em>* {user}</em></span><span class="caction u-{user}">{message}</span>'],recv_join:['<span class="cevent bg">** {user} has joined *</span>'],recv_part:['<span class="cevent bg">** {user} has left * <em>{r}</em></span>'],recv_privchg:['<span class="cevent">** {user} has been made a member of {pc} by {by} *</span>'],recv_kicked:['<span class="cevent">** {user} has been kicked by {by} * <em>{r}</em></span>'],recv_admin_create:['<span class="cevent admin">** Privilege class {pc} has been created by {user} * <em>{privs}</em></span>'],recv_admin_update:['<span class="cevent admin">** Privilege class {pc} has been updated by {user} * <em>{privs}</em></span>'],recv_admin_rename:['<span class="cevent admin">** Privilege class {prev} has been renamed to {pc} by {user} *</span>'],recv_admin_move:['<span class="cevent admin">** All members of {prev} have been moved to {pc} by {user} * <em>{affected} affected user(s)</em></span>'],recv_admin_remove:['<span class="cevent admin">** Privilege class {pc} has been removed by {user} * <em>{affected} affected user(s)</em></span>'],recv_admin_show:null,recv_admin_showverbose:null,recv_admin_privclass:['<span class="cevent admin">** Admin command "{command}" failed * <em>{e}</em></span>'],kicked:['<span class="servermsg">** You have been kicked by {user} * <em>{r}</em></span>'],ping:null,disconnect:['<span class="servermsg">** You have been disconnected * <em>{e}</em></span>',false,true],send:['<span class="servermsg">** Send error: <em>{e}</em></span>'],kick:['<span class="servermsg">** Could not kick {user} * <em>{e}</em></span>'],get:['<span class="servermsg">** Could not get {p} info for {ns} * <em>{e}</em></span>'],set:['<span class="servermsg">** Could not set {p} * <em>{e}</em></span>'],kill:['<span class="servermsg">** Kill error * <em>{e}</em></span>'],unknown:['<span class="servermsg">** Received unknown packet in {ns} * <em>{packet}</em></span>',true],}
};wsc.Protocol.prototype.extend_maps=function(a){for(key in a){this.maps[key]=a[key]}};wsc.Protocol.prototype.extend_messages=function(a){for(key in a){this.messages[key]=a[key]}};wsc.Protocol.prototype.parse=function(b){name=this.event(b);if(!(name in this.maps)){console.log("unknown: ",name);console.log(this.maps);mapping=this.maps.unknown;name="unknown"}else{mapping=this.maps[name]}var a={name:name,pkt:b,ns:null};cmd=b.cmd;if(this.mapper[cmd]){this.mapper[cmd](b,a,mapping)}else{this.map(b,a,mapping)}return a};wsc.Protocol.prototype.event=function(b){var j=b.cmd;var a=null;for(var g in this.chains){a=this.chains[g];if(a[0]!=j){continue}var k=b.sub[0];j=j+"_"+k.cmd;if(a.length>1&&k.param!=undefined){if(a[1]==k.cmd){return j+"_"+k.param}}}return j};wsc.Protocol.prototype.map=function(p,m,g){for(var l in g){if(g[l]==null){continue}var j=g[l];var a=j;switch(parseInt(l)){case 0:m[j]=p.param;break;case 1:if(g[1] instanceof Array){for(var q in g[1]){j=g[1][q];if(j instanceof Array){m[j[1]]=p.arg[j[0]];
a=j[1]}else{var b=j[0]=="*"?j.slice(1):j;m[j]=p.arg[b]||"";a=j}}}if(typeof g[1]=="string"){m[j]=p.arg.slice(0)}break;case 2:if(j instanceof Array){p.sub[0].sub=p.sub.slice(1);this.map(p.sub[0],m,j)}else{m[j]=p.body}break;case 3:m[j]=p.raw;break}if(a[0]!="*"){continue}b=a.slice(1);val=this.mparser.parse(m[a]);m[b]=val}};wsc.Protocol.prototype.render=function(a,b){msgm=this.messages[a.name];if(!msgm){return""}msg=msgm[0];for(key in a){if(!a.hasOwnProperty(key)||key=="pkt"){continue}d=a[key];if(key=="ns"||key=="sns"){key="ns";d=a.sns}if(d.hasOwnProperty("_parser")){switch(b){case"text":d=d.text();break;case"html":d=d.html();break;case"ansi":d=d.ansi();break;default:d=d.text();break}}msg=replaceAll(msg,"{"+key+"}",d)}return msg};wsc.Protocol.prototype.log=function(a,g){msgm=this.messages[g.name];if(!msgm){return}if(g.s=="0"){return}g.html=this.render(g,"html");try{if(!msgm[2]){if(!msgm[1]){a.ui.channel(g.ns).log_item(g)}else{a.ui.channel(a.mns).log_item(g)}}else{a.ui.log_item(g)}}catch(b){console.log(">> Failed to log message for "+g.sns+"::");
console.log(">> "+g.html)}};wsc.Flow=function(a){this.protocol=a||new wsc.Protocol()};wsc.Flow.prototype.open=function(a,g,b){a.trigger("connected",{name:"connected",pkt:new wsc.Packet("connected\n\n")});a.connected=true;a.handshake();a.attempts=0};wsc.Flow.prototype.close=function(a,b){a.trigger("closed",{name:"closed",pkt:new wsc.Packet("connection closed\n\n")});if(a.connected){a.ui.server_message("Connection closed");a.connected=false;if(a.conn instanceof wsc.SocketIO){a.ui.server_message("At the moment there is a problem with reconnecting under socket.io.");a.ui.server_message("Refresh the page to connect.");return}}else{a.ui.server_message("Connection failed")}if(a.attempts>2){a.ui.server_message("Can't connect. Try again later.");a.attempts=0;return}a.ui.server_message("Connecting in 2 seconds");setTimeout(function(){a.connect()},2000)};wsc.Flow.prototype.message=function(a,j){var b=new wsc.Packet(unescape(replaceAll(j.data,"+"," ")));if(b==null){return}var g=this.protocol.parse(b);
if(g.ns==null){g.ns=a.mns}g.sns=a.deform_ns(g.ns);this.protocol.log(a,g);this.handle(a,g);a.trigger("pkt",g);a.trigger("pkt."+g.name,g)};wsc.Flow.prototype.handle=function(a,g){try{this[g.name](g,a)}catch(b){}};wsc.Flow.prototype.ping=function(b,a){a.pong()};wsc.Flow.prototype.chatserver=function(b,a){a.login()};wsc.Flow.prototype.login=function(g,a){if(g.pkt.arg["e"]=="ok"){info=new wsc.Packet("info\n"+g.data);a.settings.username=g.pkt.param;a.settings.symbol=info.arg.symbol;a.settings.userinfo=info.arg;if(a.fresh){a.join(a.settings.autojoin);if(a.autojoin.on){for(var b in a.autojoin.channel){if(!a.autojoin.channel.hasOwnProperty(b)){continue}a.join(a.autojoin.channel[b])}}}else{for(key in a.channelo){if(a.channelo[key].namespace[0]!="~"){a.join(key)}}}}else{}if(a.fresh){a.fresh=false}};wsc.Flow.prototype.join=function(b,a){if(b.pkt.arg["e"]=="ok"){ns=a.deform_ns(b.pkt.param);a.create_ns(ns);a.ui.channel(ns).server_message("You have joined "+ns)}else{a.ui.chatbook.current.server_message("Failed to join "+a.deform_ns(b.pkt.param),b.pkt.arg["e"])
}};wsc.Flow.prototype.part=function(g,a){var b=a.deform_ns(g.ns);var j=a.channel(b);if(g.e=="ok"){info="";if(g.r.length>0){info="["+g.r+"]"}else{a.remove_ns(b)}msg="You have left "+b;j.server_message(msg,info);if(a.channels()==0){switch(g.r){case"bad data":case"bad msg":case"msg too big":break;default:if(g.r.indexOf("killed:")<0){return}break}this.message(a,{data:"disconnect\ne="+e.r+"\n"})}}else{a.monitor("Couldn't leave "+b,g.e);j.server_message("Couldn't leave "+b,g.e)}};wsc.Flow.prototype.kicked=function(b,a){if(b.r.toLowerCase().indexOf("autokicked")>-1){return}a.join(b.ns)};wsc.Flow.prototype.property=function(b,a){chan=a.channel(b.pkt.param);if(!chan){return}chan.property(b)};wsc.Flow.prototype.recv_joinpart=function(b,a){c=a.channel(b.ns);if(b.name=="recv_join"){c.recv_join(b)}else{c.recv_part(b)}};wsc.Flow.prototype.recv_join=wsc.Flow.prototype.recv_joinpart;wsc.Flow.prototype.recv_part=wsc.Flow.prototype.recv_joinpart;wsc.Flow.prototype.recv_msg=function(b,a){a.channel(b.ns).recv_msg(b)
};wsc.Flow.prototype.recv_action=wsc.Flow.prototype.recv_msg;wsc.Flow.prototype.recv_npmsg=wsc.Flow.prototype.recv_msg;wsc.Flow.prototype.recv_privchg=function(b,a){a.channel(b.ns).recv_privchg(b)};wsc.Flow.prototype.recv_kicked=function(b,a){a.channel(b.ns).recv_kicked(b)};wsc.defaults.Extension=function(p){var r={};r.away={on:false,reason:"",last:{},since:0,store:p.storage.folder("away"),format:{setaway:"/me is away: {reason}",setback:"/me is back",away:"{from}: I am away, reason: {reason}"}};var E=function(){p.bind("cmd.connect",g);p.bind("cmd.set",a);p.bind("cmd.join",K);p.bind("cmd.part",N);p.bind("cmd.say",s);p.bind("cmd.npmsg",O);p.bind("cmd.me",v);p.bind("cmd.promote",B);p.bind("cmd.demote",B);p.bind("cmd.ban",m);p.bind("cmd.unban",m);p.bind("cmd.kick",j);p.bind("cmd.whois",G);p.bind("cmd.title",k);p.bind("cmd.topic",k);p.bind("cmd.admin",C);p.bind("cmd.disconnect",g);p.bind("cmd.kill",j);p.bind("cmd.raw",L);p.bind("cmd.clear",I);p.bind("cmd.clearall",H);p.bind("cmd.close",D);p.bind("pkt.property",l);
p.bind("pkt.recv_admin_show",M);p.bind("pkt.recv_admin_showverbose",M);p.bind("pkt.get",z);p.bind("cmd.gettitle",u);p.bind("cmd.gettopic",u);p.bind("cmd.theme",b);p.ui.on("settings.open",q);p.ui.on("settings.open.ran",J);p.ui.on("settings.save",F)};var F=function(Q,P){p.settings.ui.theme=Q.theme;p.settings.ui.clock=Q.clock;p.settings.ui.tabclose=Q.tabclose;p.config_save()};var q=function(R,Q){var P=R.settings.page("Main",true);var S={};S.username=p.settings.username;S.pk=p.settings.pk;P.item("Form",{ref:"login",title:"Login",text:"Here you can change the username and token used to                    log into the chat server.",fields:[["Textfield",{ref:"username",label:"Username","default":S.username}],["Textfield",{ref:"token",label:"Token","default":S.pk}]],event:{save:function(T){p.settings.username=T.data.username;p.settings.pk=T.data.token}}},true);P.item("Text",{ref:"intro",title:"Main",text:"Use this window to view and change your settings.\n\nCheck                    the different pages to see what settings can be changed.",},true);
P.item("Text",{ref:"debug",wclass:"faint",title:"Debug Information",text:"Chat Agent: <code>"+p.settings.agent+"</code>\n\nUser                    Agent: <code>"+navigator.userAgent+"</code>"})};var J=function(R,Q){var P=R.settings.page("About",true);P.item("Text",{ref:"about-wsc",title:"Wsc",text:'Currently using <a href="http://github.com/photofroggy/wsc/">wsc</a>                    version '+wsc.VERSION+" "+wsc.STATE+'.\n\nWsc                    works using HTML5, javascript, and CSS3. WebSocket is used for the connection                    where possible. The source code for this client is pretty huge.\n\nWsc was created                    by ~<a href="http://photofroggy.deviantart.com/">photofroggy</a>'})};var b=function(Q,P){P.ui.theme(Q.args.split(" ").shift())};var a=function(R){var Q=R.args.split(" ");var P=Q.shift().toLowerCase();var Q=Q.join(" ");if(Q.length==0){p.cchannel.serverMessage("Could not set "+P,"No data supplied");return}if(!(P in p.settings)){p.cchannel.serverMessage('Unknown setting "'+P+'"');
return}p.settings[P]=Q;p.cchannel.serverMessage("Changed "+P+" setting","value: "+Q);p.control.setLabel()};var g=function(P){p[P.cmd]()};var K=function(P){var Q=P.args.split(" ");var Q=Q.toString()==""?[]:Q;if(P.ns!=P.target){Q.unshift(P.target)}if(Q.toString()==""){return}for(index in Q){p.join(Q[index])}};var N=function(P){var Q=P.args.split(" ");if(P.ns!=P.target){Q.unshift(P.target)}if(Q.toString()==""){p.part(P.ns);return}for(index in Q){p.part(Q[index])}};var k=function(P){p.set(P.target,P.cmd,P.args)};var B=function(Q){var P=Q.args.split(" ");p[Q.cmd.toLowerCase()](Q.target,P[0],P[1])};var m=function(T,P){var R=T.args.split(" ");var Q=R.shift();var S=T.cmd;if(S=="ban"&&R.length>0){P.kick(T.target,Q,R.join(" "))}P[S](T.target,Q)};var v=function(P){p.action(P.target,P.args)};var L=function(P){p.send(P.args.replace(/\\n/gm,"\n"))};var j=function(S,P){var T=S.args.split(" ");var Q=T.shift();var R=T.length>0?T.join(" "):null;if(S.cmd=="kick"){P.kick(S.target,Q,R)}else{P.kill(Q,R)}};var s=function(P){p.say(P.target,P.args)
};var O=function(P){p.npmsg(P.target,P.args)};var I=function(R,P){if(R.args.length>0){var S=R.args.split(" ");for(var Q in S){if(!S.hasOwnProperty(Q)){continue}P.channel(R.target).clear(S[Q])}}else{P.channel(R.target).clear()}};var H=function(Q,P){var S=null;if(Q.args.length>0){var R=Q.args.split(" ");S=function(U,V){for(var T in R){if(!R.hasOwnProperty(T)){continue}V.clear(R[T])}}}else{S=function(T,U){U.clear()}}P.each_channel(S,true)};var D=function(P){p.part(P.target);p.remove_ns(P.target)};var G=function(Q,P){P.whois(Q.args.split(" ")[0])};var C=function(Q,P){P.admin(Q.target,Q.args)};var A=function(Q,P){P.disconnect()};var u=function(Q,P){var R=Q.cmd.indexOf("title")>-1?"title":"topic";P.control.ui.set_text("/"+R+" "+P.channel(Q.target).info[R].content)};var l=function(S,P){if(S.p!="info"){return}var Q=S.pkt.sub;var T=Q.shift().arg;T.username=S.sns.substr(1);T.connections=[];var R={};while(Q.length>0){R=Q.shift().arg;R.channels=[];while(Q.length>0){if(Q[0].cmd!="ns"){break}R.channels.unshift(P.deform_ns(Q.shift().param))
}T.connections.push(R)}P.cchannel.log_whois(T)};var z=function(Q,P){if(Q.ns.indexOf("login:")!=0){return}P.cchannel.server_message("Whois failed for "+(Q.sns.substr(1)),"not online")};var M=function(T,Q){var W=Q.channel(T.ns);var P=T.info.split("\n");var V="";var U=[];var R="";for(var S in P){if(!P.hasOwnProperty(S)){continue}V=P[S].split(" ");if(T.p=="privclass"){U.push([V.shift(),V.shift().split("=")[1],V.join(" ")])}else{if(T.p=="users"){R=V.shift().split(":",1)[0];U.push([R,W.get_privclass_order(R),V.join(" ")])}}}W.log_pc(T.p=="privclass",U)};E();wsc.defaults.Extension.Autojoin(p);wsc.defaults.Extension.Away(p);wsc.defaults.Extension.Ignore(p)};wsc.defaults.Extension.Autojoin=function(a){var g=a.autojoin;var j=function(){a.bind("cmd.autojoin",b);a.ui.on("settings.open",g.page)};g.page=function(m,q){var p=m.settings.page("Autojoin",true);var l="<ul>";var s={};s.ajon=a.autojoin.on;if(a.autojoin.channel.length==0){l+="<li><i>No autojoin channels set</i></li></ul>"}else{for(var k in a.autojoin.channel){if(!a.autojoin.channel.hasOwnProperty(k)){continue
}l+="<li>"+a.autojoin.channel[k]+"</li>"}l+="</ul>"}p.item("Text",{ref:"intro",title:"Autojoin",text:"Add any channels you want to join automatically when you                    connect to the chat server."});var r=p.item("Form",{ref:"autojoin",wclass:"boxed-ff-indv",title:"Channels",text:"This is the list of channels on your autojoin.\n\nUse the                    command <code>/autojoin</code> to edit the list.",fields:[["Checkbox",{ref:"enabled",label:"Autojoin",items:[{value:"yes",title:"On",selected:s.ajon}]}],["Text",{ref:"channels",text:l}]],event:{change:function(u){},save:function(u){}}})};var b=function(s){var l=s.args.split(" ");if(!l){return}var q=l.shift().toLowerCase();var k=function(v){};var p=false;var u=a.channel(s.ns);switch(q){case"add":k=function(v){if(a.autojoin.channel.indexOf(v)==-1){p=true;a.autojoin.channel.push(v);u.server_message("Added "+v+" to your autojoin.")}else{u.server_message("Already have "+v+" on your autojoin.")}};break;case"rem":case"remove":k=function(z){var v=a.autojoin.channel.indexOf(z);
if(v!=-1){p=true;a.autojoin.channel.splice(v,1);u.server_message("Removed "+z+" from your autojoin.")}else{u.server_message(z+" is not on your autojoin list.")}};break}var r="";for(var m in l){if(!l.hasOwnProperty(m)){continue}r=a.deform_ns(l[m]).toLowerCase();k(r)}if(p){a.config_save()}};j()};wsc.defaults.Extension.Away=function(b){var j=b.storage.folder("away");var g={on:false,reason:"",last:{},since:0,interval:60000,format:{setaway:"/me is away: {reason}",setback:"/me is back",away:"{user}: I've been away for {timesince}. Reason: {reason}"}};var q=function(){m();k();b.bind("cmd.setaway",a);b.bind("cmd.setback",p);b.bind("pkt.recv_msg.highlighted",l);b.ui.on("settings.open",g.page)};g.page=function(r,u){var s=r.settings.page("Away",true);var v={};v.away=g.format.away;v.sa=g.format.setaway;v.sb=g.format.setback;v.intr=g.interval;s.item("Text",{ref:"intro",title:"Away Messages",text:"Use away messages when you are away from the chats.\n\n                    You can set yourself away using the                     <code>/setaway [reason]</code> command. When you get back,                    use <code>/setback</code>. While you are away, the client                    will automatically respond when people try to talk to you,                    telling them you're away.",});
s.item("Form",{ref:"msgs",title:"Messages",text:"Here you can set the messages displayed when you set                    yourself away or back. You can also change the away message                    format.",hint:"<b>{user}</b><br/>This is replaced with the username of the person trying to talk to you\n\n<b>{reason}</b>                    <br/>This is replaced by your reason for being away.\n\n<b>{timesince}</b>                    <br/>Use this to show how long you have been away for.",fields:[["Textfield",{ref:"away",label:"Away","default":v.away}],["Textfield",{ref:"setaway",label:"Setaway","default":v.sa}],["Textfield",{ref:"setback",label:"Setback","default":v.sb}]],event:{save:function(z){g.format.away=z.data.away;g.format.setaway=z.data.setaway;g.format.setback=z.data.setback;k()}}});s.item("Form",{ref:"interval",title:"Message Interval",text:"Here you can set the amount of time to wait before                     displaying another away message. The interval is in seconds.",fields:[["Textfield",{ref:"interval",label:"Interval","default":(v.intr/1000).toString()}]],event:{save:function(z){g.interval=parseInt(z.data.interval)*1000;
k()}}})};var a=function(u,r){g.on=true;g.last={};g.since=new Date();g.reason=u.args;var v=r.say;var s=replaceAll(g.format.setaway,"{reason}",g.reason||"[silent away]");if(s.indexOf("/me ")==0){s=s.substr(4);v=r.action}r.each_channel(function(z){v.call(r,z,s)})};var p=function(u,r){g.on=false;var v=r.say;var s=g.format.setback;if(s.indexOf("/me ")==0){s=s.substr(4);v=r.action}r.each_channel(function(z){v.call(r,z,s)})};var l=function(z,r){if(!g.on){return}if(g.reason.length==0){return}if(z.user==r.settings.username){return}if(r.exclude.indexOf(z.sns.toLowerCase())!=-1){return}var u=new Date();var v=z.sns.toLowerCase();if(v in g.last){if((u-g.last[v])<=g.interval){return}}var s=timeLengthString((u-g.since)/1000);var A=replaceAll(g.format.away,"{user}",z.user);A=replaceAll(A,"{timesince}",s);r.say(z.ns,replaceAll(A,"{reason}",g.reason));g.last[v]=u};var m=function(){g.format.setaway=j.get("setaway","/me is away: {reason}");g.format.setback=j.get("setback","/me is back");g.format.away=j.get("away","{user}: I've been away for {timesince}. Reason: {reason}");
g.interval=parseInt(j.get("interval",60000))};var k=function(){j.set("interval",g.interval);j.set("setaway",g.format.setaway);j.set("setback",g.format.setback);j.set("away",g.format.away)};q()};wsc.defaults.Extension.Ignore=function(g){var j={};var k=g.storage.folder("ignore");var a=k.folder("ignored");var q=function(){p();m();g.bind("cmd.ignore",b);g.bind("cmd.unignore",l);g.ui.on("settings.open",j.page)};j.page=function(u,z){var v=u.settings.page("Ignores",true);var B={};var s="<ul>";B.im=j.ignore;B.uim=j.unignore;if(g.ui.umuted.length==0){s+="<li><i>No one ignored yet</i></li></ul>"}else{for(var r in g.ui.umuted){if(!g.ui.umuted.hasOwnProperty(r)){continue}s+="<li>"+g.ui.umuted[r]+"</li>"}s+="</ul>"}v.item("Text",{ref:"intro",title:"Ignores",text:'Use <code>ignore</code> to ignore people.\n\n                    You can "ignore" other users of the chat server using the\n                    <code>/ignore</code> command. Ignoring a user hides their                    messages from you in the channel log.',});
v.item("Form",{ref:"msgs",title:"Messages",text:"Here you can set the messages displayed when you ignore or                    unignore a user.\n\nThe text <code>{user}</code> is replaced                    with the name of the user your are ignoring or unignoring.",fields:[["Textfield",{ref:"ignore",label:"Ignore","default":B.im}],["Textfield",{ref:"unignore",label:"Unignore","default":B.uim}]],event:{save:function(C){j.ignore=C.data.ignore;j.unignore=C.data.unignore;m()}}});var A=v.item("Form",{ref:"ignored",wclass:"boxed-ff-indv",title:"Users",text:"This is the list of users that you have silenced.\n\nUse the                    commands <code>/ignore</code> and <code>/unignore</code>                    to edit the list.",fields:[["Text",{ref:"users",text:s}]]})};var b=function(v){var A=v.args.split(" ");var r="";var z="";var u=false;for(var s in A){if(!A.hasOwnProperty(s)){continue}r=A[s];tmod=g.mute_user(r);if(!tmod){continue}u=tmod;z=replaceAll(j.ignore,"{user}",r);if(z.indexOf("/me ")==0){z=z.substr(4);
g.action(v.target,z)}else{g.say(v.target,z)}}if(u){m()}};var l=function(z){var C=z.args.split(" ");var s="";var B="";var r=-1;var v=false;var A=false;for(var u in C){if(!C.hasOwnProperty(u)){continue}s=C[u];A=g.unmute_user(s);if(!A){continue}v=A;B=replaceAll(j.unignore,"{user}",s);if(B.indexOf("/me ")==0){B=B.substr(4);g.action(z.target,B)}else{g.say(z.target,B)}}if(v){m()}};var p=function(){j.ignore=k.get("ignore","/me is ignoring {user} now");j.unignore=k.get("unignore","/me is not ignoring {user} anymore");j.count=parseInt(k.get("count",0));g.ui.umuted=[];if(j.count>0){var s=null;for(var r=0;r<j.count;r++){g.mute_user.push(a.get(r,null))}}};var m=function(){k.set("ignore",j.ignore);k.set("unignore",j.unignore);for(var r=0;r<j.count;r++){a.remove(r)}if(g.ui.umuted.length==0){k.set("count",0)}else{var s=-1;for(var r in g.ui.umuted){if(!g.ui.umuted.hasOwnProperty(r)){continue}s++;a.set(s.toString(),g.ui.umuted[r])}s++;j.count=s;k.set("count",s)}};q()};wsc.Client=function(a,g,j){this.mozilla=j;
this.storage=new wsc.Storage;this.storage.ui=this.storage.folder("ui");this.storage.aj=this.storage.folder("autojoin");this.storage.aj.channel=this.storage.aj.folder("channel");this.fresh=true;this.attempts=0;this.connected=false;this.protocol=null;this.flow=null;this.ui=null;this.events=new EventEmitter();this.conn=null;this.channelo={};this.cchannel=null;this.exclude=[];this.cmds=[];this.settings={domain:"website.com",server:"ws://website.com/wsendpoint",symbol:"",username:"",userinfo:{},pk:"",monitor:["~Monitor",true],welcome:"Welcome to the wsc web client!",autojoin:"chat:channel",control:wsc.Control,protocol:wsc.Protocol,mparser:wsc.MessageParser,flow:wsc.Flow,ui_object:Chatterbox.UI,extend:[wsc.defaults.Extension],client:"chatclient",clientver:"0.3",ui:{theme:wsc.defaults.theme,themes:wsc.defaults.themes,tabclose:true,clock:true}};this.autojoin={on:true,count:0,channel:[]};this.settings=Object.extend(this.settings,g);this.config_load();this.config_save();this.ui=new this.settings.ui_object(a,{themes:this.settings.ui.themes,theme:this.settings.ui.theme,monitor:this.settings.monitor,username:this.settings.username,domain:this.settings.domain,clock:this.settings.ui.clock,tabclose:this.settings.ui.tabclose},j);
this.settings.agent=this.ui.LIB+"/"+this.ui.VERSION+" ("+navigator.appVersion.match(/\(([^)]+)\)/)[1]+") wsc/"+wsc.VERSION+"-r"+wsc.REVISION;this.mns=this.format_ns(this.settings.monitor[0]);this.lun=this.settings.username.toLowerCase();this.protocol=new this.settings.protocol(new this.settings.mparser());this.flow=new this.settings.flow(this.protocol);this.build();for(var b in this.settings.extend){this.settings.extend[b](this)}this.monitor(this.settings.welcome)};wsc.Client.prototype.config_load=function(){this.settings.ui.theme=this.storage.ui.get("theme",this.settings.ui.theme);this.settings.ui.clock=(this.storage.ui.get("clock",this.settings.ui.clock.toString())=="true");this.settings.ui.tabclose=(this.storage.ui.get("tabclose",this.settings.ui.tabclose.toString())=="true");this.autojoin.on=(this.storage.aj.get("on","true")=="true");this.autojoin.count=parseInt(this.storage.aj.get("count","0"));var a=null;var g=0;for(var b=0;b<this.autojoin.count;b++){a=this.storage.aj.channel.get(b,null);
if(a==null){continue}g++;this.autojoin.channel.push(a)}this.autojoin.count=g};wsc.Client.prototype.config_save=function(){this.storage.ui.set("theme",this.settings.ui.theme);this.storage.ui.set("clock",this.settings.ui.clock.toString());this.storage.ui.set("tabclose",this.settings.ui.tabclose.toString());this.storage.aj.set("on",this.autojoin.on.toString());this.storage.aj.set("count",this.autojoin.count);for(var a=0;a<this.autojoin.count;a++){this.storage.aj.channel.remove(a)}if(this.autojoin.channel.length==0){this.storage.aj.set("count",0)}else{var b=-1;for(var a in this.autojoin.channel){if(!this.autojoin.channel.hasOwnProperty(a)){continue}b++;this.storage.aj.channel.set(b.toString(),this.autojoin.channel[a])}b++;this.storage.aj.set("count",b)}};wsc.Client.prototype.build=function(){this.ui.build();this.control=new this.settings.control(this);var a=this;this.ui.on("channel.selected",function(b,g){a.cchannel=a.channel(b.ns);a.control.cache_input(b)});this.ui.on("tab.close.clicked",function(b,g){if(b.chan.monitor){return false
}a.part(b.ns);a.remove_ns(b.ns);return false})};wsc.Client.prototype.loop=function(){this.ui.loop()};wsc.Client.prototype.add_extension=function(a){this.settings.extend.push(a);a(this)};wsc.Client.prototype.bind=function(b,a){this.events.addListener(b,a);if(b.indexOf("cmd.")!=0||b.length<=4){return}cmd=b.slice(4).toLowerCase();this.cmds.push(cmd)};wsc.Client.prototype.clear_listeners=function(a){this.events.removeListeners(a)};wsc.Client.prototype.trigger=function(a,b){this.events.emit(a,b,this)};wsc.Client.prototype.connect=function(){if(this.connected){return}this.attempts++;try{var a=this;this.conn=wsc.Transport.Create(this.settings.server);this.conn.open(function(g,j){a.flow.open(a,g,j)});this.conn.disconnect(function(g){a.flow.close(a,g)});this.conn.message(function(g){a.flow.message(a,g)});this.conn.connect();this.ui.server_message("Opening connection");this.trigger("start",new wsc.Packet("client connecting\ne=ok\n\n"))}catch(b){console.log(b);this.monitor("Your browser does not support WebSockets. Sorry.");
this.trigger("start",new wsc.Packet("client connecting\ne=no websockets available\n\n"))}};wsc.Client.prototype.close=function(){console.log(this.conn);this.conn.close()};wsc.Client.prototype.channel=function(a,b){a=this.deform_ns(a).slice(1).toLowerCase();if(!this.channelo[a]&&b){this.channelo[a]=b}return this.channelo[a]};wsc.Client.prototype.channels=function(b){var a=[];for(ns in this.channelo){if(!this.channelo.hasOwnProperty(ns)){continue}if(this.channelo[ns].hidden){continue}a.push(this.channelo[ns].namespace)}return b?a:a.length};wsc.Client.prototype.each_channel=function(j,a){var g=null;for(var b in this.channelo){if(!this.channelo.hasOwnProperty(b)){continue}g=this.channelo[b];if(!a){if(this.exclude.indexOf(g.namespace.toLowerCase())!=-1){continue}}if(j(g.namespace,g)===false){break}}};wsc.Client.prototype.deform_ns=function(a){if(a.indexOf("chat:")==0){return"#"+a.slice(5)}if(a.indexOf("server:")==0){return"~"+a.slice(7)}if(a.indexOf("pchat:")==0){var b=a.split(":");b.shift();
for(i in b){name=b[i];if(name.toLowerCase()!=this.lun){return"@"+name}}}if(a.indexOf("login:")==0){return"@"+a.slice(6)}if(a[0]!="#"&&a[0]!="@"&&a[0]!="~"){return"#"+a}return a};wsc.Client.prototype.format_ns=function(a){if(a.indexOf("#")==0){return"chat:"+a.slice(1)}if(a.indexOf("@")==0){var b=[a.slice(1),this.lun];b.sort(caseInsensitiveSort);b.unshift("pchat");return b.join(":")}if(a.indexOf("~")==0){return"server:"+a.slice(1)}if(a.indexOf("chat:")!=0&&a.indexOf("server:")!=0&&a.indexOf("pchat:")!=0){return"chat:"+a}return a};wsc.Client.prototype.create_ns=function(a,b){chan=this.channel(a,new wsc.Channel(this,a,b));chan.build()};wsc.Client.prototype.remove_ns=function(a){if(!a){return}var b=this.channel(a);if(!b){return}b.remove();delete this.channelo[b.selector]};wsc.Client.prototype.log=function(a,b){var g=this.channel(a);if(!g){return}g.log(b)};wsc.Client.prototype.monitor=function(a){this.ui.monitor(a)};wsc.Client.prototype.mute_user=function(a){return this.ui.mute_user(a)};wsc.Client.prototype.unmute_user=function(a){return this.ui.unmute_user(a)
};wsc.Client.prototype.send=function(a){return this.conn.send(a)};wsc.Client.prototype.handshake=function(){this.send(wsc_packetstr(this.settings.client,this.settings.clientver,{agent:this.settings.agent}))};wsc.Client.prototype.login=function(){pkt="login "+this.settings.username+"\npk="+this.settings.pk+"\n";this.send(pkt)};wsc.Client.prototype.pong=function(){this.send(wsc_packetstr("pong"))};wsc.Client.prototype.join=function(a){this.send(wsc_packetstr("join",this.format_ns(a)))};wsc.Client.prototype.part=function(a){this.send(wsc_packetstr("part",this.format_ns(a)))};wsc.Client.prototype.say=function(a,b){e={msg:b,ns:a};this.trigger("send.msg.before",e);this.send(wsc_packetstr("send",this.format_ns(a),{},wsc_packetstr("msg","main",{},e.msg)))};wsc.Client.prototype.npmsg=function(a,b){e={msg:b,ns:a};this.trigger("send.npmsg.before",e);this.send(wsc_packetstr("send",this.format_ns(a),{},wsc_packetstr("npmsg","main",{},e.msg)))};wsc.Client.prototype.action=function(a,b){e={name:"send.action.before",msg:b,ns:a};
this.trigger(e);this.send(wsc_packetstr("send",this.format_ns(a),{},wsc_packetstr("action","main",{},e.msg)))};wsc.Client.prototype.promote=function(g,a,b){this.send(wsc_packetstr("send",this.format_ns(g),{},wsc_packetstr("promote",a,{},(!b?"":b))))};wsc.Client.prototype.demote=function(g,a,b){this.send(wsc_packetstr("send",this.format_ns(g),{},wsc_packetstr("demote",a,{},(!b?"":b))))};wsc.Client.prototype.ban=function(b,a){this.send(wsc_packetstr("send",this.format_ns(b),{},wsc_packetstr("ban",a)))};wsc.Client.prototype.unban=function(b,a){this.send(wsc_packetstr("send",this.format_ns(namespace),{},wsc_packetstr("unban",a,{},(!pc?"":pc))))};wsc.Client.prototype.kick=function(b,a,g){this.send(wsc_packetstr("kick",this.format_ns(b),{u:a},g||null))};wsc.Client.prototype.kill=function(a,b){this.send(wsc_packetstr("kill",a,{},b||null))};wsc.Client.prototype.admin=function(a,b){this.send(wsc_packetstr("send",this.format_ns(a),{},wsc_packetstr("admin","",{},b)))};wsc.Client.prototype.property=function(a,b){this.send(wsc_packetstr("get",this.format_ns(a),{p:b}))
};wsc.Client.prototype.set=function(a,g,b){this.send(wsc_packetstr("set",this.format_ns(a),{p:g},b))};wsc.Client.prototype.whois=function(a){this.send(wsc_packetstr("get","login:"+a,{p:"info"}))};wsc.Client.prototype.disconnect=function(){this.send(wsc_packetstr("disconnect"))};wsc.Control=function(a){this.client=a;this.ui=this.client.ui.control;this.history={};this.tab={hit:false,cache:"",matched:[],index:-1,type:0,prefix:["","/",""],};this.set_input()};wsc.Control.prototype.focus=function(){this.ui.focus()};wsc.Control.prototype.set_input=function(){var a=this;this.ui.set_handlers(function(b){return a.keypress(b)},function(b){return a.submit(b)})};wsc.Control.prototype.cache_input=function(a){h=this.get_history(a.prev.namespace);if(h.index>-1){return}h.tmp=this.ui.get_text();this.ui.set_text(this.get_history(a.chan.namespace).tmp)};wsc.Control.prototype.get_history=function(a){a=a||this.client.cchannel.namespace;if(!this.history[a]){this.history[a]={index:-1,list:[],tmp:""}}return this.history[a]
};wsc.Control.prototype.append_history=function(a){if(!a){return}h=this.get_history();h.list.unshift(a);h.index=-1;if(h.list.length>100){h.list.pop()}};wsc.Control.prototype.scroll_history=function(a){var g=this.get_history();var b=this.ui.get_text();if(g.index==-1){if(b){g.tmp=b}else{g.list[g.index]=b}}if(a){if(g.list.length>0&&g.index<(g.list.length-1)){g.index++}}else{if(g.index>-1){g.index--}}this.ui.set_text(g.list[g.index]||g.tmp)};wsc.Control.prototype.tab_item=function(a){if(!this.tab.hit){this.start_tab(a)}this.ui.chomp();this.tab.index++;if(this.tab.index>=this.tab.matched.length){this.tab.index=-1}if(this.tab.index==-1){this.ui.unchomp(this.tab.prefix[this.tab.type]+this.tab.cache);return}suf=this.ui.get_text()==""?(this.tab.type==0?": ":" "):"";this.ui.unchomp(this.tab.prefix[this.tab.type]+this.tab.matched[this.tab.index]+suf)};wsc.Control.prototype.start_tab=function(a){this.tab.hit=true;this.tab.index=-1;this.tab.matched=[];this.tab.type=0;needle=this.ui.chomp();this.ui.unchomp(needle);
if(needle[0]=="/"||needle[0]=="#"){this.tab.type=needle[0]=="/"?1:2;needle=needle.slice(1)}else{this.tab.type=0}this.tab.cache=needle;needle=needle.toLowerCase();this.tab.matched=[];if(this.tab.type==0){for(user in this.client.cchannel.info.members){if(user.toLowerCase().indexOf(needle)==0){this.tab.matched.push(user)}}}else{if(this.tab.type==1){for(i in this.client.cmds){cmd=this.client.cmds[i];if(cmd.indexOf(needle)==0){this.tab.matched.push(cmd)}}}else{if(this.tab.type==2){for(chan in this.client.channelo){if(chan.toLowerCase().indexOf(needle)==0){this.tab.matched.push(this.client.channel(chan).namespace)}}}}}};wsc.Control.prototype.end_tab=function(a){this.tab.hit=false;this.tab.matched=[];this.tab.cache="";this.tab.index=-1};wsc.Control.prototype.submit=function(a){msg=this.ui.get_text();this.append_history(msg);this.ui.set_text("");this.handle(a,msg);return false};wsc.Control.prototype.keypress=function(g){var b=g.which||g.keyCode;var j=this.tab.hit;var a=false;switch(b){case 13:if(!this.ui.multiline()){this.submit(g)
}else{if(g.shiftKey){this.submit(g)}else{a=true}}break;case 38:if(!this.ui.multiline()){this.scroll_history(true);break}a=true;break;case 40:if(!this.ui.multiline()){this.scroll_history(false);break}a=true;break;case 9:this.tab_item(g);j=false;break;case 219:if(g.ctrlKey){this.client.ui.channel_left()}else{a=true}break;case 221:if(g.ctrlKey){this.client.ui.channel_right()}else{a=true}break;default:a=true;break}if(j){this.end_tab(g)}return a};wsc.Control.prototype.handle=function(a,b){if(b==""){return}if(b[0]!="/"){if(!this.client.cchannel){return}}b=(a.shiftKey?"/npmsg ":(b[0]=="/"?"":"/say "))+b;b=b.slice(1);bits=b.split(" ");cmdn=bits.shift().toLowerCase();ens=this.client.cchannel.namespace;etarget=ens;if(bits[0]){hash=bits[0][0];if((hash=="#"||hash=="@")&&bits[0].length>1){etarget=this.client.format_ns(bits.shift())}}arg=bits.join(" ");this.client.trigger("cmd."+cmdn,{name:"cmd",cmd:cmdn,args:arg,target:etarget,ns:ens})};var Chatterbox={};Chatterbox.VERSION="0.6.49";Chatterbox.STATE="beta";
Chatterbox.UI=function(a,b,j,g){this.events=g||new EventEmitter();this.mozilla=j;this.umuted=[];this.settings={themes:["wsct_default","wsct_dAmn"],theme:"wsct_default",monitor:["~Monitor",true],username:"",domain:"website.com",clock:true,tabclose:true};a.extend(this.settings,b);a.append('<div class="wsc '+this.settings.theme+'"></div>');this.view=a.find(".wsc");this.mns=this.format_ns(this.settings.monitor[0]);this.lun=this.settings.username.toLowerCase();this.monitoro=null;this.swidth=(function(){if($.browser.msie){var m=$('<textarea cols="10" rows="2"></textarea>').css({position:"absolute",top:-1000,left:-1000}).appendTo("body"),l=$('<textarea cols="10" rows="2" style="overflow: hidden;"></textarea>').css({position:"absolute",top:-1000,left:-1000}).appendTo("body");scrollbarWidth=m.width()-l.width();m.add(l).remove()}else{var k=$("<div />").css({width:100,height:100,overflow:"auto",position:"absolute",top:-1000,left:-1000}).prependTo("body").append("<div />").find("div").css({width:"100%",height:200});
scrollbarWidth=100-k.width();k.parent().remove()}return scrollbarWidth})();this.LIB="Chatterbox";this.VERSION=Chatterbox.VERSION;this.STATE=Chatterbox.STATE};wsc.defaults.UI=Chatterbox.UI;Chatterbox.UI.prototype.trigger=function(a,b){this.events.emit(a,b,this)};Chatterbox.UI.prototype.on=function(b,a){this.events.addListener(b,a)};Chatterbox.UI.prototype.remove_listeners=function(){this.events.removeListeners()};Chatterbox.UI.prototype.deform_ns=function(a){if(a.indexOf("chat:")==0){return"#"+a.slice(5)}if(a.indexOf("server:")==0){return"~"+a.slice(7)}if(a.indexOf("pchat:")==0){var b=a.split(":");b.shift();for(i in b){name=b[i];if(name.toLowerCase()!=this.lun){return"@"+name}}}if(a.indexOf("login:")==0){return"@"+a.slice(6)}if(a[0]!="#"&&a[0]!="@"&&a[0]!="~"){return"#"+a}return a};Chatterbox.UI.prototype.format_ns=function(a){if(a.indexOf("#")==0){return"chat:"+a.slice(1)}if(a.indexOf("@")==0){var b=[a.slice(1),this.lun];b.sort(caseInsensitiveSort);b.unshift("pchat");return b.join(":")}if(a.indexOf("~")==0){return"server:"+a.slice(1)
}if(a.indexOf("chat:")!=0&&a.indexOf("server:")!=0&&a.indexOf("pchat:")!=0){return"chat:"+a}return a};Chatterbox.UI.prototype.set_events=function(a){this.events=a||this.events};Chatterbox.UI.prototype.clock=function(a){if(a===undefined||a==this.settings.clock){return this.settings.clock}this.settings.clock=a;this.chatbook.retime();return this.settings.clock};Chatterbox.UI.prototype.build=function(g,a,b){this.view.append(Chatterbox.template.ui);this.control=new (g||Chatterbox.Control)(this);this.nav=new (a||Chatterbox.Navigation)(this);this.chatbook=new (b||Chatterbox.Chatbook)(this);this.monitoro=this.chatbook.create_channel(this.mns,this.settings.monitor[1],true);this.control.focus()};Chatterbox.UI.prototype.resize=function(){this.control.resize();this.view.height(this.view.parent().height());this.nav.resize();this.chatbook.resize(this.view.parent().height()-this.nav.height()-this.control.height())};Chatterbox.UI.prototype.loop=function(){this.chatbook.loop()};Chatterbox.UI.prototype.create_channel=function(b,a){this.chatbook.create_channel(b,a)
};Chatterbox.UI.prototype.remove_channel=function(a){this.chatbook.remove_channel(a)};Chatterbox.UI.prototype.toggle_channel=function(a){return this.chatbook.toggle_channel(a)};Chatterbox.UI.prototype.channel=function(a,b){return this.chatbook.channel(a,b)};Chatterbox.UI.prototype.channels=function(){return this.chatbook.channels()};Chatterbox.UI.prototype.channel_left=function(){this.chatbook.channel_left()};Chatterbox.UI.prototype.channel_right=function(){this.chatbook.channel_right()};Chatterbox.UI.prototype.monitor=function(b,a){this.monitoro.server_message(b,a)};Chatterbox.UI.prototype.server_message=function(b,a){this.chatbook.server_message(b,a)};Chatterbox.UI.prototype.log_item=function(a){this.chatbook.log_item(a)};Chatterbox.UI.prototype.log=function(a){this.chatbook.log(a)};Chatterbox.UI.prototype.mute_user=function(a){if(!a){return false}a=a.toLowerCase();if(this.umuted.indexOf(a)!=-1){return false}this.umuted.push(a);this.chatbook.each(function(b,g){g.mute_user(a)});return true
};Chatterbox.UI.prototype.unmute_user=function(a){if(!a){return false}a=a.toLowerCase();var b=this.umuted.indexOf(a);if(b==-1){return false}this.umuted.splice(b,1);this.chatbook.each(function(g,j){j.unmute_user(a)});return true};Chatterbox.UI.prototype.clear_user=function(a){this.chatbook.each(function(b,g){g.clear_user(a)})};Chatterbox.UI.prototype.theme=function(a){if(this.settings.theme==a){return this.settings.theme}if(this.settings.themes.indexOf(a)==-1){a="wsct_"+a;if(this.settings.themes.indexOf(a)==-1){return this.settings.theme}}this.view.removeClass(this.settings.theme).addClass(a);this.settings.theme=a;return this.settings.theme};Chatterbox.UI.prototype.add_theme=function(a){if(this.settings.themes.indexOf(a)>-1){return}this.settings.themes.push(a)};Chatterbox.Channel=function(k,g,j,b){var a=k.deform_ns(g).slice(1).toLowerCase();this.manager=k;this.hidden=j;this.monitor=b||false;this.built=false;this.selector=a;this.raw=k.format_ns(g);this.namespace=k.deform_ns(g);this.visible=false;
this.st=0};Chatterbox.Channel.prototype.build=function(){if(this.built){return}var a=this.selector;ns=this.namespace;this.tab=this.manager.nav.add_tab(a,ns);this.tabl=this.tab.find(".tab");this.tabc=this.tab.find(".close");this.manager.chatbook.view.append(Chatterbox.render("channel",{selector:a,ns:ns}));this.window=this.manager.chatbook.view.find("#"+a+"-window");this.logpanel=this.window.find("#"+a+"-log");this.wrap=this.logpanel.find("ul.logwrap");this.userpanel=this.window.find("#"+a+"-users");var g=this;this.tabl.click(function(){g.manager.toggle_channel(a);return false});this.tabc.click(function(j){g.manager.trigger("tab.close.clicked",{ns:g.namespace,chan:g,e:j});return false});var b=true;this.window.click(function(j){if(b){g.manager.control.focus()}else{b=true}});this.logpanel.select(function(){b=false});if(this.hidden){this.tab.toggleClass("hidden")}this.built=true};Chatterbox.Channel.prototype.hide=function(){this.window.css({display:"none"});this.tab.removeClass("active");this.visible=false
};Chatterbox.Channel.prototype.show=function(){this.visible=true;this.window.css({display:"block"});this.tab.addClass("active");this.tab.removeClass("noise chatting tabbed fill");this.resize()};Chatterbox.Channel.prototype.remove=function(){this.tab.remove();this.window.remove()};Chatterbox.Channel.prototype.scroll=function(){this.pad();var a=this.wrap.prop("scrollWidth")-this.wrap.innerWidth();var b=this.wrap.prop("scrollHeight")-this.wrap.innerHeight();if(a>0){b+=a}if(b<0||(b-this.wrap.scrollTop())>100){return}this.wrap.scrollTop(b)};Chatterbox.Channel.prototype.pad=function(){this.wrap.css({"padding-top":0,height:"auto"});wh=this.wrap.innerHeight();lh=this.logpanel.innerHeight()-this.logpanel.find("header").height()-3;pad=lh-wh;if(pad>0){this.wrap.css({"padding-top":pad})}else{this.wrap.css({"padding-top":0,height:lh})}this.wrap.scrollTop(this.st)};Chatterbox.Channel.prototype.resize=function(){this.wrap.css({"padding-top":0});wh=this.manager.chatbook.height();this.window.height(wh);
cw=this.window.width();cu=this.window.find("div.chatusers");title=this.window.find("header div.title");topic=this.window.find("header div.topic");if(cu.css("display")!="none"){cu.width(1);userwidth=cu[0].scrollWidth+this.manager.swidth+5;max=parseInt(cu.css("max-width").slice(0,-2));if(userwidth>max){userwidth=max}cu.width(userwidth);cw=cw-cu.outerWidth()}if(title.css("display")=="block"){wh=wh-title.outerHeight(true)}this.logpanel.css({height:wh-3,width:cw-3});this.scroll();cu.css({height:this.logpanel.innerHeight()})};Chatterbox.Channel.prototype.loop=function(){msgs=this.logpanel.find(".logmsg");if(msgs.length<200){return}msgs.slice(0,msgs.length-200).remove();this.resize()};Chatterbox.Channel.prototype.log=function(a){data={ns:this.namespace,message:a};this.manager.trigger("log.before",data);this.log_item({html:Chatterbox.render("logmsg",{message:data.message})})};Chatterbox.Channel.prototype.log_item=function(b){var a=new Date();ts="";if(this.manager.settings.clock){ts=formatTime("{HH}:{mm}:{ss}",a)
}else{ts=formatTime("{hh}:{mm}:{ss} {mr}",a)}data={ts:ts,ms:a.getTime(),message:b.html,user:(b.user||"system").toLowerCase()};this.manager.trigger("log_item.before",data);if(this.visible){this.st=this.wrap.scrollTop()}this.wrap.append(Chatterbox.render("logitem",data));this.manager.trigger("log_item.after",{item:this.wrap.find("li").last()});this.st+=13;this.wrap.scrollTop(this.st);this.scroll();this.noise()};Chatterbox.Channel.prototype.retime=function(){var a="";var b=this.wrap;if(this.manager.settings.clock){a="{HH}:{mm}:{ss}"}else{a="{hh}:{mm}:{ss} {mr}"}b.find("span.ts").each(function(g,j){el=b.find(j);time=new Date(parseInt(el.prop("id")));el.text(formatTime(a,time))})};Chatterbox.Channel.prototype.server_message=function(b,a){data={ns:this.namespace,message:b,info:a};this.manager.trigger("server_message.before",data);this.log_item({html:Chatterbox.render("servermsg",{message:data.message,info:data.info})})};Chatterbox.Channel.prototype.clear=function(){this.logpanel.find("li.logmsg").remove();
this.logpanel.find("li.loginfo").remove();this.wrap.height(0);this.resize()};Chatterbox.Channel.prototype.log_info=function(k,j){data={ns:this.namespace,ref:k,content:j};this.manager.trigger("log_info.before",data);delete data.ns;var a=this.wrap.append(Chatterbox.render("loginfobox",data));this.scroll();var l=this;var g=this.wrap.find("li."+data.ref);g.find("a.close").click(function(b){l.wrap.find(this).parent().remove();l.resize();return false});return g};Chatterbox.Channel.prototype.log_whois=function(p){var j={avatar:'<a href="#"><img height="50" width="50" alt="avatar"/></a>',username:"<b>"+p.symbol+p.username+"</b>",info:[],conns:[],raw:p,};for(var q in p.connections){var m=p.connections[q];var s=[];if(m.online){stamp=(new Date-(m.online*1000));s.push(["online",DateStamp(stamp/1000)+formatTime(" [{HH}:{mm}:{ss}]",new Date(stamp))])}if(m.idle){s.push(["idle",timeLengthString(m.idle)])}if(m.agent){s.push(["agent",m.agent])}if(m.debug){s.push(["debug",m.debug])}s.push(["chatrooms",m.channels.join(" ")]);
j.conns.push(s)}this.manager.trigger("log_whois.before",j);var a="";for(var q in j.conns){var l=j.conns[q];var u='<section class="conn"><p><em>connection '+((parseInt(q)+1).toString())+":</em></p>";u+="<ul>";for(x in l){u+="<li><strong>"+l[x][0]+":</strong> "+l[x][1]+"</li>"}u+="</ul>";a+=u+"</section>"}var k="";for(var q in j.info){k+="<li>"+j.info[q]+"</li>"}var r=this.log_info("whois-"+p.username,Chatterbox.render("whoiswrap",{avatar:j.avatar,info:Chatterbox.render("whoisinfo",{username:j.username,info:k,connections:a})}));var g=r.find("div.avatar");var b=r.find("div.info");b.width(r.find(".whoiswrap").width()-100);g.height(r.height()-10);this.scroll()};Chatterbox.Channel.prototype.log_pc=function(j,k){contents="";for(var g in k){if(!k.hasOwnProperty(g)){continue}var b=k[g];var a="";if(b[2].length==0){a="<em>"+(j?"default privileges":"no members")+"</em>"}else{a=b[2]}contents+=String.format("<li><em>{0}</em> <strong>{1}</strong>:<ul><li>{2}</li></ul></li>",[b[1],b[0],a])}var l={title:"Privilege class "+(j?"permissions":"members"),info:"<ul>"+contents+"</ul>"};
this.log_info("pc-"+(j?"permissions":"members"),Chatterbox.render("pcinfo",l))};Chatterbox.Channel.prototype.set_header=function(a,b){headd=this.window.find("header div."+a);headd.replaceWith(Chatterbox.render("header",{head:a,content:b||""}));headd=this.window.find("header div."+a);if(b){headd.css({display:"block"})}else{this.window.find("header div."+a).css({display:"none"})}this.resize()};Chatterbox.Channel.prototype.get_header=function(a){return this.window.find("header div."+a)};Chatterbox.Channel.prototype.set_user_list=function(a){if(Object.size(a)==0){return}infoboxes=[];html="";for(order in a){pc=a[order];html+='<div class="pc"><h3>'+pc.name+"</h3><ul>";for(un in pc.users){user=pc.users[un];conn=user.conn==1?"":"["+user.conn+"]";html+='<li><a target="_blank" id="'+user.name+'" href="http://'+user.name+"."+this.manager.settings.domain+'"><em>'+user.symbol+"</em>"+user.name+"</a>"+conn+"</li>";if(user.hover){infoboxes.push(user.hover)}}html+="</ul></div>"}this.window.find("div.chatusers").html(html);
this.userpanel=this.window.find("div.chatusers");this.userpanel.css({display:"block"});for(index in infoboxes){this.userinfo(infoboxes[index])}this.resize()};Chatterbox.Channel.prototype.highlight=function(g){var a=this.tab;(g||this.window.find(".logmsg").last()).addClass("highlight");if(a.hasClass("active")){return}if(a.hasClass("tabbed")){return}var j=0;a.addClass("tabbed");function b(){j++;a.toggleClass("fill");if(j==6){return}setTimeout(b,1000)}b()};Chatterbox.Channel.prototype.noise=function(){var b="";var a=0;var j=this.window.find(".logmsg").last();for(var g in this.manager.umuted){if(!this.manager.umuted.hasOwnProperty(g)){continue}if(j.hasClass("u-"+this.manager.umuted[g])){j.css({display:"none"});this.scroll();return}}if(!this.tab.hasClass("active")){this.tab.addClass("noise");if(j.find(".cevent").length==0){this.tab.addClass("chatting")}}};Chatterbox.Channel.prototype.userinfo=function(a){var g=this.window.find("a#"+a.name);if(g.length==0){return}var j=this;var b=null;g.hover(function(k){a.info=[];
ed={ns:j.namespace,user:a};j.manager.trigger("userinfo.before",ed);a=ed.user;infoli="";for(index in a.info){infoli+="<li>"+a.info[index]+"</li>"}j.window.append(Chatterbox.render("userinfo",{username:a.name,avatar:a.avatar,link:a.link,info:infoli}));b=j.window.find(".userinfo#"+a.name);j.window.find("div.userinfo:not('#"+a.name+"')").remove();pos=g.offset();b.css({top:(pos.top-g.height())+10,left:(pos.left-(b.width()))-6});b.find(".info").height(b.height());b.hover(function(){b.data("hover",1)},function(l){b.data("hover",0);j.unhover_user(b,l)});b.data("hover",0)},function(k){g.data("hover",0);j.unhover_user(b,k)})};Chatterbox.Channel.prototype.unhover_user=function(b,a){o=b.offset();eb=b.outerHeight(true)+o.top;er=b.outerWidth(true)+o.left;x=a.pageX;y=a.pageY;if(x>o.left&&x<er&&y>o.top&&y<eb){return}if(x<(er+15)&&x>o.left&&y>o.top&&y<(o.top+15)){return}b.remove()};Chatterbox.Channel.prototype.mute_user=function(a){if(!a){return}this.wrap.find("li.logmsg.u-"+a.toLowerCase()).css({display:"none"});
this.scroll()};Chatterbox.Channel.prototype.unmute_user=function(a){if(!a){return}this.wrap.find("li.logmsg.u-"+a.toLowerCase()).css({display:"list-item"});this.scroll()};Chatterbox.Channel.prototype.clear_user=function(a){if(!a){return}this.wrap.find("li.logmsg.u-"+a.toLowerCase()).remove();this.scroll()};Chatterbox.Chatbook=function(a){this.manager=a;this.view=this.manager.view.find("div.chatbook");this.chan={};this.trail=[];this.current=null;this.manager.on("tab.close.clicked",function(b,g){g.chatbook.remove_channel(b.ns)})};Chatterbox.Chatbook.prototype.height=function(){return this.view.height()};Chatterbox.Chatbook.prototype.resize=function(a){a=a||600;this.view.height(a);for(select in this.chan){var b=this.chan[select];b.resize()}};Chatterbox.Chatbook.prototype.loop=function(){for(select in this.chan){this.chan[select].loop()}};Chatterbox.Chatbook.prototype.channel=function(a,b){a=this.manager.deform_ns(a).slice(1).toLowerCase();if(!this.chan[a]&&b){this.chan[a]=b}return this.chan[a]
};Chatterbox.Chatbook.prototype.channels=function(){chans=-1;for(ns in this.chan){if(this.chan[ns].hidden){continue}chans++}return chans};Chatterbox.Chatbook.prototype.create_channel=function(b,g,a){chan=this.channel(b,this.channel_object(b,g,a));chan.build();this.toggle_channel(b);this.manager.resize();return chan};Chatterbox.Chatbook.prototype.channel_object=function(a,b){return new Chatterbox.Channel(this.manager,a,b)};Chatterbox.Chatbook.prototype.toggle_channel=function(a){var g=this.channel(a);var b=g;if(!g){return}if(this.current){if(this.current==g){return}this.current.hide();b=this.current}g.show();this.manager.control.focus();this.current=g;this.manager.resize();if(this.trail.indexOf(g.namespace)==-1){this.trail.push(g.namespace)}this.manager.trigger("channel.selected",{ns:g.namespace,chan:g,prev:b})};Chatterbox.Chatbook.prototype.remove_channel=function(a){if(this.channels()==0){return}var b=this.channel(a);b.remove();delete this.chan[b.selector];if(this.current==b){this.channel_left()
}rpos=this.trail.indexOf(b.namespace);this.trail.splice(rpos,1)};Chatterbox.Chatbook.prototype.channel_left=function(){var b=this.current.namespace;var a=this.trail.indexOf(b);if(a<0){return}var j=null;while(true){try{j=this.channel(this.trail[--a])}catch(g){a=this.trail.length-1;j=this.channel(this.trail[a])}if(!j.hidden){break}}this.toggle_channel(j.namespace)};Chatterbox.Chatbook.prototype.channel_right=function(){var b=this.current.namespace;var a=this.trail.indexOf(b);if(a==-1){return}var j=null;while(true){try{j=this.channel(this.trail[++a])}catch(g){a=0;j=this.channel(this.trail[0])}if(!j.hidden){break}}this.toggle_channel(j.namespace)};Chatterbox.Chatbook.prototype.each=function(g){var b=null;for(var a in this.chan){if(!this.chan.hasOwnProperty(a)){continue}b=this.chan[a];if(g(b.namespace,b)===false){break}}};Chatterbox.Chatbook.prototype.server_message=function(b,a){for(ns in this.chan){this.chan[ns].server_message(b,a)}};Chatterbox.Chatbook.prototype.log_item=function(a){for(ns in this.chan){this.chan[ns].log_item(a)
}};Chatterbox.Chatbook.prototype.log=function(a){for(ns in this.chan){this.chan[ns].log(a)}};Chatterbox.Chatbook.prototype.retime=function(){for(ns in this.chan){this.chan[ns].retime()}};Chatterbox.Control=function(b){this.manager=b;this.manager.view.append(Chatterbox.template.control);this.view=this.manager.view.find("div.chatcontrol");this.form=this.view.find("form.msg");this.input=this.form.find("input.msg");this.mli=this.form.find("textarea.msg");this.ci=this.input;this.ml=false;this.mlb=this.view.find("a[href~=#multiline].button");var a=this;this.mlb.click(function(g){a.multiline(!a.multiline());return false})};Chatterbox.Control.prototype.focus=function(){this.ci.focus()};Chatterbox.Control.prototype.resize=function(){w=this.manager.view.width();this.view.css({width:"100%"});this.form.css({width:this.manager.view.width()-20});this.input.css({width:this.manager.view.width()-100});this.mli.css({width:this.manager.view.width()-90})};Chatterbox.Control.prototype.height=function(){return this.view.height()
};Chatterbox.Control.prototype.set_handlers=function(b,a){if(this.manager.mozilla){this.input.keypress(b||this._onkeypress);this.mli.keypress(b||this._onkeypress)}else{this.input.keydown(b||this._onkeypress);this.mli.keydown(b||this._onkeypress)}this.form.submit(a||this._onsubmit)};Chatterbox.Control.prototype.multiline=function(a){if(a==undefined||this.ml==a){return this.ml}this.ml=a;if(this.ml){this.input.css("display","none");this.mli.css("display","inline-block");this.ci=this.mli;this.manager.resize();return this.ml}this.mli.css("display","none");this.input.css("display","inline-block");this.ci=this.input;this.manager.resize();return this.mli};Chatterbox.Control.prototype._onkeypress=function(a){};Chatterbox.Control.prototype._onsubmit=function(a){};Chatterbox.Control.prototype.chomp=function(){d=this.ci.val();i=d.lastIndexOf(" ");if(i==-1){this.ci.val("");return d}chunk=d.slice(i+1);this.ci.val(d.slice(0,i));if(chunk.length==0){return this.chomp()}return chunk};Chatterbox.Control.prototype.unchomp=function(a){d=this.ci.val();
if(!d){this.ci.val(a)}else{this.ci.val(d+" "+a)}};Chatterbox.Control.prototype.get_text=function(a){if(a==undefined){return this.ci.val()}this.ci.val(a||"");return this.ci.val()};Chatterbox.Control.prototype.set_text=function(a){this.ci.val(a||"")};Chatterbox.Navigation=function(a){this.manager=a;this.showclose=this.manager.settings.tabclose;this.nav=this.manager.view.find("nav.tabs");this.tabs=this.nav.find("#chattabs");this.buttons=this.nav.find("#tabnav");this.tableft=this.buttons.find(".arrow_left");this.tabright=this.buttons.find(".arrow_right");this.settingsb=this.buttons.find("#settings-button");this.settings={};this.settings.open=false;if(!this.showclose){if(!this.tabs.hasClass("hc")){this.tabs.addClass("hc")}}var b=this;this.settingsb.click(function(k){if(b.settings.open){return false}var g={e:k,settings:new Chatterbox.Settings.Config()};b.configure_page(g);b.manager.trigger("settings.open",g);b.manager.trigger("settings.open.ran",g);var j=g.settings.page("About",true);j.item("text",{ref:"about-chatterbox",wclass:"centered faint",text:'Using <a href="http://github.com/photofroggy/wsc/">Chatterbox</a> version '+Chatterbox.VERSION+" "+Chatterbox.STATE+' by ~<a href="http://photofroggy.deviantart.com/">photofroggy</a>.'});
b.settings.window=new Chatterbox.Settings(b.manager,g.settings);b.settings.window.build();b.settings.open=true;return false});this.tableft.click(function(){b.manager.channel_left();return false});this.tabright.click(function(){b.manager.channel_right();return false})};Chatterbox.Navigation.prototype.configure_page=function(b){var j=this.manager;var g=b.settings.page("Main",true);var k={};k.theme=replaceAll(j.settings.theme,"wsct_","");k.clock=j.clock();k.tc=j.nav.closer();var a=[];for(i in j.settings.themes){name=replaceAll(j.settings.themes[i],"wsct_","");a.push({value:name,title:name,selected:k.theme==name})}g.item("Form",{ref:"ui",title:"UI",hint:"<b>Timestamp</b><br/>Choose between a 24 hour clock and                a 12 hour clock.\n\n<b>Theme</b><br/>Change the look of the                client.\n\n<b>Close Buttons</b><br/>Turn tab close buttons on/off.",fields:[["Dropdown",{ref:"theme",label:"Theme",items:a}],["Dropdown",{ref:"clock",label:"Timestamp Format",items:[{value:"24",title:"24 hour",selected:k.clock},{value:"12",title:"12 hour",selected:!k.clock}]}],["Check",{ref:"tabclose",label:"Close Buttons",items:[{value:"yes",title:"On",selected:k.tc}]}],],event:{change:function(l){j.clock(l.data.clock=="24");
j.theme(l.data.theme);j.nav.closer(l.data.tabclose.indexOf("yes")>-1)},save:function(l){k.clock=j.clock();k.theme=replaceAll(j.theme(),"wsct_","");k.tc=j.nav.closer();j.trigger("settings.save",{clock:k.clock,tabclose:k.tc,theme:"wsct_"+k.theme})},close:function(l){j.clock(k.clock);j.theme(k.theme);j.nav.closer(k.tc)}}})};Chatterbox.Navigation.prototype.height=function(){return this.nav.height()};Chatterbox.Navigation.prototype.add_tab=function(a,b){this.tabs.append(Chatterbox.render("tab",{selector:a,ns:b}));return this.tabs.find("#"+a+"-tab")};Chatterbox.Navigation.prototype.resize=function(){this.tabs.width(this.nav.width()-this.buttons.outerWidth()-20);if(this.settings.open){this.settings.window.resize()}};Chatterbox.Navigation.prototype.closer=function(a){if(a==undefined||a==this.showclose){return this.showclose}this.showclose=a;if(this.showclose){if(!this.tabs.hasClass("hc")){return}this.tabs.removeClass("hc");return}if(this.tabs.hasClass("hc")){return}this.tabs.addClass("hc")};Chatterbox.Popup=function(b,a){this.manager=b;
this.window=null;this.closeb=null;this.options=Object.extend({ref:"popup",title:"Popup",close:true,content:""},(a||{}))};Chatterbox.Popup.prototype.build=function(){var b={ref:this.options.ref,title:this.options.title,content:this.options.content};if(this.options.close){b.title+='<a href="#close" class="button close medium iconic x"></a>'}this.manager.view.append(Chatterbox.render("popup",b));this.window=this.manager.view.find(".floater."+b.ref);if(this.options.close){this.closeb=this.window.find("a.close");var a=this;this.closeb.click(function(g){a.close();return false})}};Chatterbox.Popup.prototype.close=function(){this.window.remove()};Chatterbox.Settings=function(b,a){Chatterbox.Popup.call(this,b,{ref:"settings",title:"Settings",close:false,content:""});this.config=a;this.saveb=null;this.scb=null;this.tabs=null;this.book=null;this.changed=false};Chatterbox.Settings.prototype=new Chatterbox.Popup();Chatterbox.Settings.prototype.constructor=Chatterbox.Settings;Chatterbox.Settings.prototype.build=function(){this.options.content=Chatterbox.template.settings.main;
Chatterbox.Popup.prototype.build.call(this);this.saveb=this.window.find("a.button.save");this.closeb=this.window.find("a.close");this.scb=this.window.find("a.button.saveclose");this.tabs=this.window.find("nav.tabs ul.tabs");this.book=this.window.find("div.book");this.config.build(this);this.window.find("ul.tabs li").first().addClass("active");this.window.find("div.book div.page").first().addClass("active");var a=this;this.window.find("form").bind("change",function(){a.changed=true});this.saveb.click(function(b){a.save();return false});this.closeb.click(function(b){if(a.changed){if(!confirm("Are you sure? You will lose any unsaved changes.")){return false}}a.close();return false});this.scb.click(function(b){a.save();a.close();return false});this.resize()};Chatterbox.Settings.prototype.resize=function(){var a=this.window.find(".inner");var g=a.find("h2");var j=a.find(".bookwrap");var b=a.find("footer");j.height(a.height()-b.outerHeight()-g.outerHeight()-15);this.book.height(j.innerHeight()-this.tabs.outerHeight()-25);
this.config.resize()};Chatterbox.Settings.prototype.switch_page=function(b){var g=this.tabs.find("li.active").first();var a=g.prop("id").split("-",1)[0];g=this.config.page(a.split("_").join(" "));g.hide();b.show()};Chatterbox.Settings.prototype.save=function(){this.config.save(this);this.changed=false};Chatterbox.Settings.prototype.close=function(){this.window.remove();this.manager.nav.settings.open=false;this.manager.nav.settings.window=null;this.config.close(this)};Chatterbox.Settings.Config=function(){this.pages=[]};Chatterbox.Settings.Config.prototype.find_page=function(a){n=a.toLowerCase();for(index in this.pages){page=this.pages[index];if(page.lname==n){return page}}return null};Chatterbox.Settings.Config.prototype.build=function(a){for(i in this.pages){this.pages[i].build(a)}};Chatterbox.Settings.Config.prototype.resize=function(){for(i in this.pages){this.pages[i].resize()}};Chatterbox.Settings.Config.prototype.page=function(b,a){var g=this.find_page(b);a=a||false;if(g==null){g=new Chatterbox.Settings.Page(b);
if(a){this.pages.push(g)}else{this.pages.unshift(g)}}return g};Chatterbox.Settings.Config.prototype.save=function(a){for(i in this.pages){this.pages[i].save(a)}};Chatterbox.Settings.Config.prototype.close=function(a){for(i in this.pages){this.pages[i].close(a)}};Chatterbox.Settings.Page=function(a){this.name=a;this.lname=a.toLowerCase();this.ref=replaceAll(this.lname," ","_");this.items=[];this.itemo={}};Chatterbox.Settings.Page.prototype.build=function(b){var a=replaceAll(Chatterbox.template.settings.tab,"{ref}",this.ref);a=replaceAll(a,"{name}",this.name);var g=replaceAll(Chatterbox.template.settings.page,"{ref}",this.ref);g=replaceAll(g,"{page-name}",this.name);b.tabs.append(a);b.book.append(g);this.view=b.book.find("div#"+this.ref+"-page");this.tab=b.tabs.find("li#"+this.ref+"-tab");var g=this;this.tab.find("a").click(function(j){if(g.tab.hasClass("active")){return false}b.switch_page(g);return false});this.content()};Chatterbox.Settings.Page.prototype.content=function(){for(i in this.items){this.items[i].build(this.view)
}};Chatterbox.Settings.Page.prototype.resize=function(){for(i in this.items){this.items[i].resize()}};Chatterbox.Settings.Page.prototype.show=function(){if(!this.tab.hasClass("active")){this.tab.addClass("active")}if(!this.view.hasClass("active")){this.view.addClass("active")}this.resize()};Chatterbox.Settings.Page.prototype.hide=function(){if(this.tab.hasClass("active")){this.tab.removeClass("active")}if(this.view.hasClass("active")){this.view.removeClass("active")}};Chatterbox.Settings.Page.prototype.item=function(g,b,a){a=a||false;var j=Chatterbox.Settings.Item.get(g,b);if(a){this.items.unshift(j)}else{this.items.push(j)}if(b.hasOwnProperty("ref")){this.itemo[b.ref]=j}return j};Chatterbox.Settings.Page.prototype.save=function(a){for(i in this.items){this.items[i].save(a,this)}};Chatterbox.Settings.Page.prototype.close=function(a){for(i in this.items){this.items[i].close(a,this)}};Chatterbox.Settings.Item=function(b,a){this.options=a||{};this.type=b||"base";this.selector=this.type.toLowerCase();
this.items=[];this.itemo={};this.view=null};Chatterbox.Settings.Item.prototype.build=function(l){if(!this.options.hasOwnProperty("ref")){return}var k=this.content();if(k.length==0){return}var a="";if(this.options.hasOwnProperty("wclass")){a=" "+this.options.wclass}var j=Chatterbox.render("settings.item.wrap",{type:this.type.toLowerCase().split(".").join("-"),ref:this.options.ref,"class":a});j=replaceAll(j,"{content}",k);l.append(j);this.view=l.find(".item."+this.options.ref);this.hooks(this.view);if(!this.options.hasOwnProperty("subitems")){return}var m;var g;var b;for(i in this.options.subitems){m=this.options.subitems[i];g=m[0];b=m[1];sitem=Chatterbox.Settings.Item.get(g,b);cls=["stacked"];if(sitem.options.wclass){cls.push(sitem.options.wclass)}sitem.options.wclass=cls.join(" ");sitem.build(this.view);this.items.push(sitem);if(b.hasOwnProperty("ref")){this.itemo[b.ref]=sitem}}};Chatterbox.Settings.Item.prototype.content=function(){return Chatterbox.render("settings.item."+this.selector,this.options)
};Chatterbox.Settings.Item.prototype.resize=function(){for(i in this.items){this.items[i].resize()}};Chatterbox.Settings.Item.prototype.hooks=function(b){if(!this.options.hasOwnProperty("event")){return}var a=this.options.event;var g=Chatterbox.template.settings.item.get(this.selector);if(g==false){return}if(!g.hasOwnProperty("events")){return}for(i in g.events){pair=g.events[i];if(!a.hasOwnProperty(pair[0])){continue}b.find(pair[1]).bind(pair[0],a[pair[0]])}};Chatterbox.Settings.Item.prototype._event_stub=function(){};Chatterbox.Settings.Item.prototype._get_cb=function(a){if(!this.options.hasOwnProperty("event")){return this._event_stub}return this.options.event[a]||this._event_stub};Chatterbox.Settings.Item.prototype._get_ep=function(a){var b=Chatterbox.template.settings.item.get(this.selector);if(b==null){return false}if(!b.hasOwnProperty("events")){return false}for(i in b.events){pair=b.events[i];if(pair[0]==a){return pair}}};Chatterbox.Settings.Item.prototype.save=function(g,j){var k=this._get_ep("inspect");
var b=k==false?null:this.view.find(k[1]);var a=this._get_cb("save");if(typeof a=="function"){a({input:b,item:this,page:j,window:g})}else{for(i in a){var l=b.hasOwnProperty("slice")?b.slice(i,1):b;a[i]({input:l,item:this,page:j,window:g})}}for(i in this.items){this.items[i].save(g,j)}};Chatterbox.Settings.Item.prototype.close=function(a,b){pair=this._get_ep("inspect");inps=pair==false?null:this.view.find(pair[1]);cb=this._get_cb("close");if(typeof cb=="function"){cb({input:inps,item:this,page:b,window:a});return}for(i in cb){sinps=inps.hasOwnProperty("slice")?inps.slice(i,1):inps;cb[i]({input:sinps,item:this,page:b,window:a})}for(i in this.items){this.items[i].close(a,b)}};Chatterbox.Settings.Item.get=function(g,b,j,a){types=g.split(".");item=j||Chatterbox.Settings.Item;for(i in types){cls=types[i];if(!item.hasOwnProperty(cls)){item=a||Chatterbox.Settings.Item;break}item=item[cls]}return new item(g,b)};Chatterbox.Settings.Item.Form=function(b,a){Chatterbox.Settings.Item.call(this,b,a);this.form=null;
this.fields=[];this.lsection=null;this.fsection=null;this.fieldo={}};Chatterbox.Settings.Item.Form.prototype=new Chatterbox.Settings.Item();Chatterbox.Settings.Item.Form.prototype.constructor=Chatterbox.Settings.Item.Form;Chatterbox.Settings.Item.Form.field=function(b,a){return Chatterbox.Settings.Item.get(b,a,Chatterbox.Settings.Item.Form,Chatterbox.Settings.Item.Form.Field)};Chatterbox.Settings.Item.Form.prototype.build=function(b){Chatterbox.Settings.Item.prototype.build.call(this,b);if(this.view==null){return}this.lsection=this.view.find("section.labels");this.fsection=this.view.find("section.fields");if(!this.options.hasOwnProperty("fields")){return}for(i in this.options.fields){f=this.options.fields[i];field=Chatterbox.Settings.Item.Form.field(f[0],f[1]);this.fields.push(field);field.build(this);if(f[1].hasOwnProperty("ref")){this.fieldo[f[1].ref]=field}}this.form=this.view.find("form");var a=this;this.form.bind("change",function(g){a.change()})};Chatterbox.Settings.Item.Form.prototype.resize=function(){for(i in this.fields){this.fields[i].resize()
}};Chatterbox.Settings.Item.Form.prototype.change=function(){data={};for(i in this.fields){field=this.fields[i];data[field.ref]=field.get()}cb=this._get_cb("change");if(typeof cb=="function"){cb({data:data,form:this})}else{for(i in cb){cb[i]({data:data,form:this})}}};Chatterbox.Settings.Item.Form.prototype.save=function(a,g){var b={};for(i in this.fields){field=this.fields[i];b[field.ref]=field.get()}cb=this._get_cb("save");if(typeof cb=="function"){cb({data:b,form:this,page:g,window:a})}else{for(i in cb){cb[i]({data:b,form:this,page:g,window:a})}}};Chatterbox.Settings.Item.Form.prototype.close=function(a,b){data={};for(i in this.fields){field=this.fields[i];data[field.ref]=field.get()}cb=this._get_cb("close");if(typeof cb=="function"){cb({data:data,form:this,page:b,window:a})}else{for(i in cb){cb[i]({data:data,form:this,page:b,window:a})}}};Chatterbox.Settings.Item.Form.Field=function(b,a){Chatterbox.Settings.Item.call(this,b,a);this.ref=this.options.ref||"ref";this.label=null;this.field=null;
this.value=""};Chatterbox.Settings.Item.Form.Field.prototype=new Chatterbox.Settings.Item();Chatterbox.Settings.Item.Form.Field.prototype.constructor=Chatterbox.Settings.Item.Form.Field;Chatterbox.Settings.Item.Form.Field.prototype.build=function(a){a.lsection.append(Chatterbox.render("settings.item.form.label",{ref:this.ref,label:this.options.label||"","class":(this.options["class"]?" "+this.options["class"]:"")}));this.label=a.lsection.find("label."+this.ref);this.lwrap=a.lsection.find("."+this.ref+".label");a.fsection.append(Chatterbox.render("settings.item.form.field.wrap",{ref:this.ref,field:Chatterbox.render("settings.item.form.field."+this.selector,this.options)}));this.fwrap=a.fsection.find("div."+this.ref+".field");this.field=this.fwrap.find("."+this.ref);this.view=this.fwrap;var b=this;this.value=this.field.val();this.field.bind("change",function(g){b.value=b.view.find(this).val()})};Chatterbox.Settings.Item.Form.Field.prototype.resize=function(){this.lwrap.height(this.field.height())
};Chatterbox.Settings.Item.Form.Field.prototype.get=function(){return this.value};Chatterbox.Settings.Item.Form.Radio=function(b,a){a=a||{};a["class"]=(a["class"]?(a["class"]+" "):"")+"box";Chatterbox.Settings.Item.Form.Field.call(this,b,a);this.items={};this.value=""};Chatterbox.Settings.Item.Form.Radio.prototype=new Chatterbox.Settings.Item.Form.Field();Chatterbox.Settings.Item.Form.Radio.prototype.constructor=Chatterbox.Settings.Item.Form.Radio;Chatterbox.Settings.Item.Form.Radio.prototype.build=function(g){g.lsection.append(Chatterbox.render("settings.item.form.label",{ref:this.ref,label:this.options.label||""}));this.label=g.lsection.find("label."+this.ref);this.lwrap=g.lsection.find("."+this.ref+".label");if(this.options.hasOwnProperty("items")){for(i in this.options.items){var b=this.options.items[i];b.name=this.ref;this.items[b.ref]=""}}g.fsection.append(Chatterbox.render("settings.item.form.field.wrap",{ref:this.ref,field:Chatterbox.render("settings.item.form.field.radio",this.options)}));
this.fwrap=g.fsection.find("div."+this.ref+".field");this.field=this.fwrap.find("input:radio");this.value=this.fwrap.find("input[checked]:radio").val();var a=this;this.field.bind("change",function(j){a.value=a.fwrap.find(this).val()})};Chatterbox.Settings.Item.Form.Radio.prototype.resize=function(){this.lwrap.height(this.fwrap.find(".radiobox").height())};Chatterbox.Settings.Item.Form.Radio.prototype.get=function(){return this.value};Chatterbox.Settings.Item.Form.Check=function(b,a){Chatterbox.Settings.Item.Form.Radio.call(this,b,a);this.value=[]};Chatterbox.Settings.Item.Form.Check.prototype=new Chatterbox.Settings.Item.Form.Radio();Chatterbox.Settings.Item.Form.Check.prototype.constructor=Chatterbox.Settings.Item.Form.Check;Chatterbox.Settings.Item.Form.Check.prototype.build=function(g){g.lsection.append(Chatterbox.render("settings.item.form.label",{ref:this.ref,label:this.options.label||""}));this.label=g.lsection.find("label."+this.ref);this.lwrap=g.lsection.find("."+this.ref+".label");
if(this.options.hasOwnProperty("items")){for(i in this.options.items){var b=this.options.items[i];b.name=this.ref;this.items[b.ref]=""}}g.fsection.append(Chatterbox.render("settings.item.form.field.wrap",{ref:this.ref,field:Chatterbox.render("settings.item.form.field.check",this.options)}));this.fwrap=g.fsection.find("div."+this.ref+".field");this.field=this.fwrap.find("input:checkbox");var a=this;this.value=[];this.fwrap.find("input[checked]:checkbox").each(function(){a.value.push(a.fwrap.find(this).val())});this.field.bind("change",function(j){a.value=[];a.fwrap.find("input[checked]:checkbox").each(function(){a.value.push(a.fwrap.find(this).val())})})};Chatterbox.Settings.Item.Form.Check.prototype.resize=function(){this.lwrap.height(this.fwrap.find(".checkbox").height())};Chatterbox.Settings.Item.Radio=function(b,a){Chatterbox.Settings.Item.call(this,b,a);this.value=""};Chatterbox.Settings.Item.Radio.prototype=new Chatterbox.Settings.Item();Chatterbox.Settings.Item.Radio.prototype.constructor=Chatterbox.Settings.Item.Radio;
Chatterbox.Settings.Item.Radio.prototype.build=function(g){if(this.options.hasOwnProperty("items")){for(i in this.options.items){var b=this.options.items[i];b.name=this.options.ref||"ref"}}Chatterbox.Settings.Item.prototype.build.call(this,g);this.field=this.view.find("input:radio");this.value=this.view.find("input[checked]:radio").val();var a=this;this.field.bind("change",function(j){a.value=a.view.find(this).val()})};Chatterbox.Settings.Item.Check=function(b,a){Chatterbox.Settings.Item.Radio.call(this,b,a);this.value=[]};Chatterbox.Settings.Item.Check.prototype=new Chatterbox.Settings.Item.Radio();Chatterbox.Settings.Item.Check.prototype.constructor=Chatterbox.Settings.Item.Check;Chatterbox.Settings.Item.Check.prototype.build=function(g){if(this.options.hasOwnProperty("items")){for(i in this.options.items){var b=this.options.items[i];b.name=this.options.ref||"ref"}}Chatterbox.Settings.Item.prototype.build.call(this,g);this.field=this.view.find("input:checkbox");var a=this;this.value=[];
this.view.find("input[checked]:checkbox").each(function(){a.value.push(a.view.find(this).val())});this.field.bind("change",function(j){a.value=[];a.view.find("input[checked]:checkbox").each(function(){a.value.push(a.view.find(this).val())})})};Chatterbox.Settings.Item.Form.Field.prototype.get=function(){return this.value};Chatterbox.template={};Chatterbox.render=function(j,l){var g=Chatterbox.template;var b=j.split(".");var k={};var a=null;for(ind in b){part=b[ind];if(!g.hasOwnProperty(part)){return""}g=g[part]}if(g.hasOwnProperty("frame")){a=g;k=g.render||{};g=g.frame;if(a.hasOwnProperty("pre")){if(typeof a.pre=="function"){g=a.pre(g,l)}else{for(i in a.pre){g=a.pre[i](g,l)}}}}for(key in l){g=replaceAll(g,"{"+key+"}",(k[key]||Chatterbox.template.render_stub)(l[key]||""))}if(a!=null){if(a.hasOwnProperty("post")){if(typeof a.post=="function"){g=a.post(g,l)}else{for(i in a.post){g=a.post[i](g,l)}}}}return g};Chatterbox.template.render_stub=function(a){return a};Chatterbox.template.clean=function(a){return function(b,g){for(i in a){b=replaceAll(b,"{"+a[i]+"}","")
}return b}};Chatterbox.template.ui='<nav class="tabs"><ul id="chattabs" class="tabs"></ul>        <ul id="tabnav">            <li><a href="#left" class="button iconic arrow_left"></a></li>            <li><a href="#right" class="button iconic arrow_right"></a></li>            <li><a href="#settings" title="Change client settings" class="button iconic cog" id="settings-button"></a></li>        </ul>        </nav>        <div class="chatbook"></div>';Chatterbox.template.control='<div class="chatcontrol">            <p><a href="#multiline" title="Toggle multiline input" class="button iconic list"></a></p>            <form class="msg">                <input type="text" class="msg" />                <textarea class="msg"></textarea>                <input type="submit" value="Send" class="sendmsg" />            </form>        </div>';Chatterbox.template.tab='<li id="{selector}-tab"><a href="#{selector}" class="tab">{ns}<a href="#{selector}" class="close iconic x"></a></a></li>';Chatterbox.template.channel='<div class="chatwindow" id="{selector}-window">                    <header>                        <div class="title"></div>                    </header>                    <div class="chatlog" id="{selector}-log">                        <header>                            <div class="topic"></div>                        </header>                        <ul class="logwrap"></ul>                    </div>                    <div class="chatusers" id="{selector}-users">                </div>            </div>';
Chatterbox.template.header='<div class="{head}">{content}</div>';Chatterbox.template.logmsg='<span class="message">{message}</span>';Chatterbox.template.logitem='<li class="logmsg u-{user}"><span class="ts" id="{ms}">{ts}</span> {message}</li>';Chatterbox.template.servermsg='<span class="servermsg">** {message} * <em>{info}</em></span>';Chatterbox.template.usermsg='<strong class="user">&lt;{user}&gt;</strong> {message}';Chatterbox.template.userinfo='<div class="userinfo" id="{username}">                            <div class="avatar">                                {avatar}                            </div><div class="info">                            <strong>                            {link}                            </strong>                            <ul>{info}</ul></div>                        </div>';Chatterbox.template.loginfobox='<li class="loginfo {ref}"><a href="#{ref}" class="close iconic x"></a>{content}</li>';Chatterbox.template.whois={};Chatterbox.template.whoiswrap='<div class="whoiswrap">                                <div class="avatar">{avatar}</div>                                <div class="info">{info}</div>                                </div>';
Chatterbox.template.whoisinfo="<p>{username}</p><ul>{info}</ul>{connections}";Chatterbox.template.pcinfo='<section class="pcinfo"><strong>{title}</strong>{info}</section>';Chatterbox.template.popup='<div class="floater {ref}"><div class="inner"><h2>{title}</h2><div class="content">{content}</div></div></div>';Chatterbox.template.settings={};Chatterbox.template.settings.main='<div class="bookwrap">                                <nav class="tabs">                                    <ul class="tabs"></ul>                                </nav>                                <div class="book"></div>                            </div>                            <footer>                                <a href="#save" class="button save">Save</a> <a href="#saveclose" class="button saveclose">Save & Close</a> <a href="#close" class="button close big square iconic x"></a>                            </footer>';Chatterbox.template.settings.page='<div class="page" id="{ref}-page"></div>';Chatterbox.template.settings.tab='<li id="{ref}-tab"><a href="#{ref}" class="tab" id="{ref}-tab">{name}</a></li>';
Chatterbox.template.settings.krender={};Chatterbox.template.settings.krender.title=function(a){if(a.length==0){return""}return"<h3>"+a+"</h3>"};Chatterbox.template.settings.krender.text=function(a){return replaceAll(a,"\n\n","\n</p><p>\n")};Chatterbox.template.settings.krender.dditems=function(a){if(a.length==0){return""}render="";for(i in a){item=a[i];render+='<option value="'+item.value+'"';if(item.selected){render+=' selected="yes"'}render+=">"+item.title+"</option>"}return render};Chatterbox.template.settings.krender.radioitems=function(a){if(a.length==0){return""}render="";labels=[];fields=[];for(i in a){item=a[i];labels.push(Chatterbox.render("settings.item.form.label",{ref:item.value,label:item.title}));ritem='<div class="'+item.value+' field radio"><input class="'+item.value+'" type="radio" name="'+item.name+'" value="'+item.value+'"';if(item.selected){ritem+=' checked="yes"'}fields.push(ritem+" /></div>")}return'<section class="labels">'+labels.join("")+'</section><section class="fields">'+fields.join("")+"</section>"
};Chatterbox.template.settings.krender.checkitems=function(a){if(a.length==0){return""}render="";labels=[];fields=[];for(i in a){item=a[i];if("title" in item){labels.push(Chatterbox.render("settings.item.form.label",{ref:item.value,label:item.title}))}ritem='<div class="'+item.value+' field check"><input class="'+item.value+'" type="checkbox" name="'+item.name+'" value="'+item.value+'"';if(item.selected){ritem+=' checked="yes"'}fields.push(ritem+" /></div>")}if(labels.length>0){render+='<section class="labels">'+labels.join("")+"</section>"}return render+'<section class="fields">'+fields.join("")+"</section>"};Chatterbox.template.settings.item={};Chatterbox.template.settings.item.get=function(a){var g=a.split(".");var b=Chatterbox.template.settings.item;for(i in g){tc=g[i];if(b.hasOwnProperty(tc)){b=b[tc];continue}return null}return b};Chatterbox.template.settings.item.wrap='<section class="item {type} {ref}{class}">                                    {content}                                </section>';
Chatterbox.template.settings.item.hint={};Chatterbox.template.settings.item.hint.frame='<aside class="hint">{hint}</aside>{content}';Chatterbox.template.settings.item.hint.prep=function(a,b){if(!b.hasOwnProperty("hint")){return a}return Chatterbox.render("settings.item.hint",{hint:b.hint,content:a})};Chatterbox.template.settings.item.twopane={};Chatterbox.template.settings.item.twopane.frame='{title}<div class="twopane">                                        <div class="text left">                                            <p>{text}</p>                                        </div>                                        <div class="right">                                            {template}                                        </div>                                    </div>';Chatterbox.template.settings.item.twopane.wrap=function(a,b){if(!b.hasOwnProperty("text")){return a}a=replaceAll(Chatterbox.template.settings.item.twopane.frame,"{template}",replaceAll(a,"{title}",""));return a
};Chatterbox.template.settings.item.text={};Chatterbox.template.settings.item.text.pre=Chatterbox.template.settings.item.hint.prep;Chatterbox.template.settings.item.text.post=Chatterbox.template.clean(["title","text"]);Chatterbox.template.settings.item.text.render={title:Chatterbox.template.settings.krender.title,text:Chatterbox.template.settings.krender.text};Chatterbox.template.settings.item.text.frame="{title}<p>                                        {text}                                    </p>";Chatterbox.template.settings.item.dropdown={};Chatterbox.template.settings.item.dropdown.pre=[Chatterbox.template.settings.item.twopane.wrap,Chatterbox.template.settings.item.hint.prep];Chatterbox.template.settings.item.dropdown.render={title:Chatterbox.template.settings.krender.title,text:Chatterbox.template.settings.krender.text,items:Chatterbox.template.settings.krender.dditems};Chatterbox.template.settings.item.dropdown.post=Chatterbox.template.clean(["title","items"]);Chatterbox.template.settings.item.dropdown.events=[["change","select"],["inspect","select"]];
Chatterbox.template.settings.item.dropdown.frame="{title}<form>                                                <select>                                                    {items}                                                </select>                                            </form>";Chatterbox.template.settings.item.radio={};Chatterbox.template.settings.item.radio.pre=[Chatterbox.template.settings.item.twopane.wrap,Chatterbox.template.settings.item.hint.prep];Chatterbox.template.settings.item.radio.render={title:Chatterbox.template.settings.krender.title,text:Chatterbox.template.settings.krender.text,items:Chatterbox.template.settings.krender.radioitems};Chatterbox.template.settings.item.radio.post=Chatterbox.template.clean(["ref","title","items"]);Chatterbox.template.settings.item.radio.events=[["change","input:radio"],["inspect","input:radio"]];Chatterbox.template.settings.item.radio.frame='{title}<div class="{ref} radiobox"><form>{items}</form></div>';Chatterbox.template.settings.item.check={};
Chatterbox.template.settings.item.check.pre=[Chatterbox.template.settings.item.twopane.wrap,Chatterbox.template.settings.item.hint.prep];Chatterbox.template.settings.item.check.render={title:Chatterbox.template.settings.krender.title,text:Chatterbox.template.settings.krender.text,items:Chatterbox.template.settings.krender.checkitems};Chatterbox.template.settings.item.check.post=Chatterbox.template.clean(["ref","title","items"]);Chatterbox.template.settings.item.check.events=[["change","input:checkbox"],["inspect","input:checkbox"]];Chatterbox.template.settings.item.check.frame='{title}<div class="{ref} checkbox"><form>{items}</form></div>';Chatterbox.template.settings.item.textfield={};Chatterbox.template.settings.item.textfield.pre=[Chatterbox.template.settings.item.twopane.wrap,Chatterbox.template.settings.item.hint.prep];Chatterbox.template.settings.item.textfield.render={title:Chatterbox.template.settings.krender.title,text:Chatterbox.template.settings.krender.text};Chatterbox.template.settings.item.textfield.post=Chatterbox.template.clean(["ref","title","default"]);
Chatterbox.template.settings.item.textfield.events=[["blur","input"],["inspect","input"]];Chatterbox.template.settings.item.textfield.frame='{title}<div class="{ref} textfield"><form><input type="text" value="{default}" /></form></div>';Chatterbox.template.settings.item.textarea={};Chatterbox.template.settings.item.textarea.pre=[Chatterbox.template.settings.item.twopane.wrap,Chatterbox.template.settings.item.hint.prep];Chatterbox.template.settings.item.textarea.render={title:Chatterbox.template.settings.krender.title,text:Chatterbox.template.settings.krender.text};Chatterbox.template.settings.item.textarea.post=Chatterbox.template.clean(["ref","title","default"]);Chatterbox.template.settings.item.textarea.events=[["blur","textarea"],["inspect","textarea"]];Chatterbox.template.settings.item.textarea.frame='{title}<div class="{ref} textarea"><form><textarea rows="4" cols="20" value="{default}"></textarea></form></div>';Chatterbox.template.settings.item.form={};Chatterbox.template.settings.item.form.pre=[Chatterbox.template.settings.item.twopane.wrap,Chatterbox.template.settings.item.hint.prep];
Chatterbox.template.settings.item.form.render={title:Chatterbox.template.settings.krender.title,text:Chatterbox.template.settings.krender.text,items:Chatterbox.template.settings.krender.dditems};Chatterbox.template.settings.item.form.post=Chatterbox.template.clean(["title","text","items"]);Chatterbox.template.settings.item.form.frame='{title}<form>                                                <section class="labels"></section>                                                <section class="fields"></section>                                            </form>';Chatterbox.template.settings.item.form.label={};Chatterbox.template.settings.item.form.label.post=Chatterbox.template.clean(["ref","label","class"]);Chatterbox.template.settings.item.form.label.frame='<div class="{ref} label{class}"><label for="{ref}">{label}</label></div>';Chatterbox.template.settings.item.form.field={};Chatterbox.template.settings.item.form.field.wrap={};Chatterbox.template.settings.item.form.field.wrap.post=Chatterbox.template.clean(["ref","field"]);
Chatterbox.template.settings.item.form.field.wrap.frame='<div class="{ref} field">{field}</div>';Chatterbox.template.settings.item.form.field.dropdown={};Chatterbox.template.settings.item.form.field.dropdown.render={items:Chatterbox.template.settings.krender.dditems};Chatterbox.template.settings.item.form.field.dropdown.post=Chatterbox.template.clean(["ref","items"]);Chatterbox.template.settings.item.form.field.dropdown.frame='<select class="{ref}">{items}</select>';Chatterbox.template.settings.item.form.field.textfield={};Chatterbox.template.settings.item.form.field.textfield.post=Chatterbox.template.clean(["ref","default"]);Chatterbox.template.settings.item.form.field.textfield.frame='<input class="{ref}" type="text" value="{default}" />';Chatterbox.template.settings.item.form.field.textarea={};Chatterbox.template.settings.item.form.field.textarea.post=Chatterbox.template.clean(["ref","default"]);Chatterbox.template.settings.item.form.field.textarea.frame='<textarea class="{ref}" rows="4" cols="20" value="{default}"></textarea>';
Chatterbox.template.settings.item.form.field.radio={};Chatterbox.template.settings.item.form.field.radio.render={items:Chatterbox.template.settings.krender.radioitems};Chatterbox.template.settings.item.form.field.radio.post=Chatterbox.template.clean(["ref","items"]);Chatterbox.template.settings.item.form.field.radio.frame='<div class="{ref} radiobox">{items}</div>';Chatterbox.template.settings.item.form.field.check={};Chatterbox.template.settings.item.form.field.check.render={items:Chatterbox.template.settings.krender.checkitems};Chatterbox.template.settings.item.form.field.check.post=Chatterbox.template.clean(["ref","items"]);Chatterbox.template.settings.item.form.field.check.frame='<div class="{ref} checkbox">{items}</div>';Chatterbox.template.settings.item.form.field.text={};Chatterbox.template.settings.item.form.field.text.pre=Chatterbox.template.settings.item.hint.prep;Chatterbox.template.settings.item.form.field.text.post=Chatterbox.template.clean(["title","text"]);Chatterbox.template.settings.item.form.field.text.render={title:Chatterbox.template.settings.krender.title,text:Chatterbox.template.settings.krender.text};
Chatterbox.template.settings.item.form.field.text.frame="{title}<p>                                        {text}                                    </p>";wsc.dAmn={};wsc.dAmn.VERSION="0.2.9";wsc.dAmn.STATE="alpha";wsc.dAmn.Extension=function(a){var b=a.storage.folder("dAmn");a.settings.client="dAmnClient";a.settings.clientver="0.3";a.settings.domain="deviantart.com";a.settings.agent+=" wsc/dAmn/"+wsc.dAmn.VERSION;a.protocol.extend_maps({dAmnServer:["version"]});a.protocol.extend_messages({dAmnServer:['<span class="servermsg">** Connected to dAmnServer {version} *</span>',false,true]});a.protocol.mparser=new wsc.dAmn.TablumpParser;a.flow.dAmnServer=a.flow.chatserver;a.exclude.push("#devart");a.ui.on("userinfo.before",function(g,j){g.user.avatar=wsc.dAmn.avatar.link(g.user.name,g.user.member.usericon);if(g.user.member.realname){g.user.info.push(g.user.member.realname)}if(g.user.member.typename){g.user.info.push(g.user.member.typename)}});a.ui.on("log_whois.before",function(g,j){g.avatar=wsc.dAmn.avatar.link(g.raw.username,g.raw.usericon);
g.username=g.raw.symbol+'<b><a href="http://'+g.raw.username+'.deviantart.com/">'+g.raw.username+"</a></b>";if(g.raw.realname){g.info.push(g.raw.realname)}if(g.raw.typename){g.info.push(g.raw.typename)}})};wsc.dAmn.avatar={};wsc.dAmn.avatar.ext=["gif","gif","jpg","png"];wsc.dAmn.avatar.link=function(b,j){j=parseInt(j);var l=(j>>2)&15;j=j&3;var g=wsc.dAmn.avatar.ext[j]||"gif";if(l){l="?"+l}else{l=""}if(j==0){k="default"}else{var a=new RegExp("\\$un(\\[([0-9]+)\\])","g");var k="$un[0]/$un[1]/{un}".replace(a,function(p,r,q){return b[q]=="-"?"_":b[q].toLowerCase()});k=replaceAll(k,"{un}",b.toLowerCase())}return'<a target="_blank" title=":icon'+b+':" href="http://'+b+'.deviantart.com/"><img class="avatar"            alt=":icon'+b+':" src="http://a.deviantart.net/avatars/'+k+"."+g+l+'" height="50" width="50" /></a>'};wsc.dAmn.TablumpString=function(a,b){this._parser=b||new wsc.dAmn.Tablumps();this.tokens=this._parser.tokenise(a);this.raw=a;this._text=null;this._html=null;this._ansi=null};wsc.dAmn.TablumpString.prototype=new wsc.MessageString;
wsc.dAmn.TablumpString.prototype.constructor=wsc.dAmn.TablumpString;with(wsc.dAmn.TablumpString.prototype=new String){constructor=wsc.dAmn.TablumpString;toString=valueOf=function(){return this.raw}}wsc.dAmn.TablumpString.prototype.html=function(){if(this._html==null){this._html=this._parser.render(1,this)}return this._html};wsc.dAmn.TablumpString.prototype.text=function(){if(this._text==null){this._text=this._parser.render(0,this)}return this._text};wsc.dAmn.TablumpString.prototype.ansi=function(){if(this._ansi==null){this._ansi=this._parser.render(2,this)}return this._ansi};wsc.dAmn.PARSE={RAW:0,TAG:1,ARG:2};wsc.dAmn.TablumpParser=function(){this.lumps=this.defaultMap()};wsc.dAmn.TablumpParser.prototype=new wsc.MessageParser;wsc.dAmn.TablumpParser.prototype.constructor=wsc.dAmn.TablumpParser;wsc.dAmn.TablumpParser.prototype.registerMap=function(a){this.lumps=a};wsc.dAmn.TablumpParser.prototype.extend=function(a){for(index in a){this.lumps[index]=a[index]}};wsc.dAmn.TablumpParser.prototype.defaultMap=function(){return{"&b\t":[0,"<b>","<b>","\x1b[1m"],"&/b\t":[0,"</b>","</b>","\x1b[22m"],"&i\t":[0,"<i>","<i>","\x1b[3m"],"&/i\t":[0,"</i>","</i>","\x1b[23m"],"&u\t":[0,"<u>","<u>","\x1b[4m"],"&/u\t":[0,"</u>","</u>","\x1b[24m"],"&s\t":[0,"<s>","<s>","\x1b[9m"],"&/s\t":[0,"</s>","</s>","\x1b[29m"],"&sup\t":[0,"<sup>"],"&/sup\t":[0,"</sup>"],"&sub\t":[0,"<sub>"],"&/sub\t":[0,"</sub>"],"&code\t":[0,"<code>"],"&/code\t":[0,"</code>"],"&p\t":[0,"<p>"],"&/p\t":[0,"</p>"],"&ul\t":[0,"<ul>"],"&/ul\t":[0,"</ul>"],"&ol\t":[0,"<ol>"],"&li\t":[0,"<li>"],"&/li\t":[0,"</li>"],"&/ol\t":[0,"</ol>"],"&link\t":[3,function(a){return a[0]+((" ("+a[1]+")")||"")
},function(a){t=a[1];return'<a target="_blank" href="'+a[0]+'" title="'+(t||a[0])+'">'+(t||"[link]")+"</a>"}],"&acro\t":[1,'<acronym title="{0}">'],"&/acro\t":[0,"</acronym>"],"&abbr\t":[1,'<abbr title="{0}">'],"&/abbr\t":[0,"</abbr>"],"&img\t":[3,'<img src="{0}" alt="{1}" title="{2}" />'],"&iframe\t":[3,'<iframe src="{0}" width="{1}" height="{2}" />'],"&/iframe\t":[0,"</iframe>"],"&a\t":[2,'<a href="{0}" title="{1}">'],"&/a\t":[0,"</a>"],"&br\t":[0,"<br/>"],"&bcode\t":[0,"<bcode>","<span><pre><code>"],"&/bcode\t":[0,"</bcode>","</code></pre></span>"],"&avatar\t":[2,":icon{0}:",function(a){return wsc.dAmn.avatar.link(a[0],a[1])}],"&emote\t":[5,"{0}",'<img alt="{0}" width="{1}" height="{2}" title="{3}" src="http://e.deviantart.com/emoticons/{4}" />'],"&dev\t":[2,":dev{1}:",'{0}<a target="_blank" alt=":dev{1}:" href="http://{1}.deviantart.com/">{1}</a>',"{0}\x1b[36m{1}\x1b[39m"],"&thumb\t":[7,":thumb{0}:",function(a){id=a[0];user=a[2];dim=a[3].split("x");w=parseInt(dim[0]);h=parseInt(dim[1]);
f=a[5];flags=a[6].split(":");lu=user.substring(1).replace(/^[^a-zA-Z0-9\-_]/,"");t=a[1];ut=(t.replace(/[^A-Za-z0-9]+/g,"-").replace(/^-+/,"").replace(/-+$/,"")||"-")+"-"+id;title=t+" by "+user+", "+w+"x"+h;dal='<a target="_blank" href="http://'+lu+".deviantart.com/art/"+ut+'" title="'+title+'"';if(flags[1]!="0"){return dal+">[mature deviation: "+t+"]</a>"}if(flags[2]!="0"){return dal+">[deviation: "+t+"]</a>"}shadow=flags[0]=="0";isgif=f.match(/\.gif$/i);if(isgif&&(w>100||h>100)){return dal+">[deviation: "+t+"]</a>"}server=parseInt(a[4]);if(w/h>1){th=parseInt((h*100)/w);tw=100}else{tw=parseInt((w*100)/h);th=100}if(tw>w||th>h){tw=w;th=h}if(isgif){f=f.replace(/:/,"/");path="http://fc0"+server+".deviantart.net/"+f;det=f.split("/");if(det.length>1){det=det["."];if(det&&det.length>2){path="http://"+file}}return dal+'><img class="thumb" title="'+title+'" width="'+tw+'" height="'+th+'" alt=":thumb'+id+':" src="'+path+'" /></a>'}path="http://backend.deviantart.com/oembed?url=http://www.deviantart.com/deviation/"+id+"&format=thumb150";
if(f.match(/.png$/i)){shadow=false}return dal+'><img class="thumb'+(shadow?" shadow":"")+'" width="'+tw+'" height="'+th+'" alt=":thumb'+id+':" src="'+path+'" /></a>'}],EOF:[0,"",null,"\x1b[m"]}};wsc.dAmn.TablumpParser.prototype.parse=function(b,a){b=replaceAll(b,"<","&lt;");b=replaceAll(b,">","&gt;");return new wsc.dAmn.TablumpString(b,this)};wsc.dAmn.TablumpParser.prototype.tokenise=function(l){if(!l){return[]}var a=wsc.dAmn.PARSE.RAW;var q=[];var b="";var j=0;var p=[];var g="";var r="";var m="";for(var k=0;k<l.length;k++){m=l[k];switch(a){case wsc.dAmn.PARSE.RAW:if(m!="&"){g+=m;break}b=m;a=wsc.dAmn.PARSE.TAG;break;case wsc.dAmn.PARSE.TAG:b+=m;if(m==" "||m=="\t"||m=="&"){if(m==" "||m=="&"||!this.lumps.hasOwnProperty(b)){g+=b;b="";if(m=="&"){k--;g=g.substr(0,g.length-1)}a=wsc.dAmn.PARSE.RAW}else{if(g.length>0){q.push(["raw",g]);g=""}p=[b,[]];j=this.lumps[b][0];q.push(p);b="";if(j>0){a=wsc.dAmn.PARSE.ARG}else{a=wsc.dAmn.PARSE.RAW}}}break;case wsc.dAmn.PARSE.ARG:if(m=="\t"){j--;if(b=="&"){a=wsc.dAmn.PARSE.RAW;
b="";break}p[1].push(b);b="";if(j==0){a=wsc.dAmn.PARSE.RAW}break}b+=m;break}}if(g.length>0||b.length>0){q.push(["raw",g+b])}return q};wsc.dAmn.TablumpParser.prototype.render=function(a,j){if(!j){return""}if(!j.hasOwnProperty("tokens")){return""}a=a+1;var k="";var g=[];for(var b in j.tokens){if(!j.tokens.hasOwnProperty(b)){continue}g=j.tokens[b];if(g[0]=="raw"){k+=g[1];continue}k+=this.renderOne(a,g[0],g[1])}return k+this.renderOne(a,"EOF","")};wsc.dAmn.TablumpParser.prototype.renderOne=function(b,a,k){var g=this.lumps[a];if(g===undefined){return"&"+a+"\t"+k.join("\t")}var j=g[b]||g[1];if(typeof(j)=="string"){return String.format(j,k)}else{return j.call(this,k)}};(function(a){a("*").hover(function(b){a(this).data("hover",true)},function(b){a(this).data("hover",false)});a.fn.wsc=function(g,b){client=a(window).data("wscclient");if(g=="init"||client===undefined){if(client==undefined){client=new wsc.Client(a(this),b,(a.browser.mozilla||false));a(window).resize(function(){client.ui.resize()});
a(window).focus(function(){client.ui.control.focus()});setInterval(function(){client.loop()},120000)}a(window).data("wscclient",client)}if(g!="init"&&g!=undefined){g="jq_"+g;if(g in client){client[g](a(this),b)}}return client};a.fn.wscui=function(g,b){ui=a(window).data("wscui");if(g=="init"||ui===undefined){if(ui==undefined){ui=new Chatterbox.UI(a(this),b,(a.browser.mozilla||false));a(window).resize(ui.resize)}a(window).data("wscui",ui)}if(g!="init"&&g!=undefined){g="jq_"+g;if(g in ui){ui[g](a(this),b)}}return ui}})(jQuery);